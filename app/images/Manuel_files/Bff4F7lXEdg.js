/*!CK:157432303!*//*1421120356,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["WOuZd"]); }

__d("FBRTCVersionDetection",[],function(a,b,c,d,e,f){var g={isChrome:function(){return !!navigator.webkitGetUserMedia;},isFirefox:function(){return !!navigator.mozGetUserMedia;},webrtcVersion:function(){if(this.isFirefox())return parseInt(navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1],10);if(this.isChrome()){var h=navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./);if(h!==null){return parseInt(h[2],10);}else return 999;}return 0;}};e.exports=g;},null);
__d("FBRTCPCConfig",["FBRTCVersionDetection"],function(a,b,c,d,e,f,g){var h="stun:stun.fbsbx.com:3478",i=function(k,l,m){if(g.isChrome()&&g.webrtcVersion()>=34){var n={urls:k};if(l&&m){n.username=l;n.credential=m;}return [n];}var o=[];for(var p=0;p<k.length;p++)if(l&&m){o.push({url:k[p],username:l,credential:m});}else o.push({url:k[p]});return o;},j={setTurnCredentials:function(k){this.turnIP=k.ip;this.udpPort=k.udp_port;this.tcpPort=k.tcp_port;this.sslPort=k.ssl_tcp_port;this.turnUsername=k.username;this.turnPassword=k.password;},getConfig:function(){var k=i([h]).concat(i(this._turnUrls(),this.turnUsername,this.turnPassword));return {iceServers:k};},getConstraints:function(){return {mandatory:{},optional:[{DtlsSrtpKeyAgreement:'true'}]};},_turnUrls:function(){if(g.isFirefox()&&g.webrtcVersion()<27){return [("turn:"+this.turnIP+":"+this.udpPort)];}else return [("turn:"+this.turnIP+":"+this.udpPort+"?transport=udp"),("turn:"+this.turnIP+":"+this.tcpPort+"?transport=tcp"),("turn:"+this.turnIP+":"+this.sslPort+"?transport=tcp")];}};e.exports=j;},null);
__d("FBRTCStatsHelpers",["FBRTCLogger"],function(a,b,c,d,e,f,g){var h=function(j){if(j==='host'||j==='local')return 'local';if(j==='serverreflexive')return 'srflx';if(j==='peerreflexive')return 'prflx';if(j==='relayed'||j==='relay')return 'relay';return 'unknown';},i={connectionType:function(j,k,l,m){return ['l:',h(j),'-',k,';','r:',h(l),'-',m].join('');},logReport:function(j){var k=g.getInstance(),l=['connectionType','audioCodec','videoCodec','audioRtt','videoRtt','audioPacketsLost','videoPacketsLost','audioBytesSent','videoBytesSent','audioPacketsSent','videoPacketsSent'];for(var m=0;m<l.length;m++){var n=j[l[m]].call(j);k.logToConsole(l[m]+' => '+n);}}};e.exports=i;},null);
__d("FBRTCMozStatsReport",["Map","FBRTCLogger","FBRTCStatsHelpers"],function(a,b,c,d,e,f,g,h,i){function j(){"use strict";this.$FBRTCMozStatsReport0=null;this.$FBRTCMozStatsReport1=null;this.$FBRTCMozStatsReport2=null;this.$FBRTCMozStatsReport3=null;this.candidates=new g();this.candidatePairs=new g();this.$FBRTCMozStatsReport4=h.getInstance();}j.prototype.parseReport=function(k){"use strict";k.forEach(function(l){switch(l.type){case 'inboundrtp':if(!l.remoteId)break;var m={inbound:l,outbound:k[l.remoteId]};if(l.isRemote){if(m.outbound.hasOwnProperty('framerateMean')){this.$FBRTCMozStatsReport1=m;}else this.$FBRTCMozStatsReport0=m;}else if(m.outbound.hasOwnProperty('framerateMean')){this.$FBRTCMozStatsReport3=m;}else this.$FBRTCMozStatsReport2=m;break;case 'outboundrtp':break;case 'candidatepair':if(l.state==='succeeded')this.candidatePairs.set(l.id,l);break;case 'localcandidate':this.candidates.set(l.id,l);break;case 'remotecandidate':this.candidates.set(l.id,l);break;default:this.$FBRTCMozStatsReport4.logToConsole('unrecognized webrtc stats type '+l.type);break;}}.bind(this));};j.prototype.isConnected=function(){"use strict";return !!this.$FBRTCMozStatsReport0;};j.prototype.audioRtt=function(){"use strict";if(!this.$FBRTCMozStatsReport0)return 0;return this.$FBRTCMozStatsReport0.inbound.mozRtt;};j.prototype.videoRtt=function(){"use strict";if(!this.$FBRTCMozStatsReport1)return 0;return this.$FBRTCMozStatsReport1.inbound.mozRtt;};j.prototype.audioCodec=function(){"use strict";return 'opus';};j.prototype.videoCodec=function(){"use strict";return 'VP8';};j.prototype.audioPacketsLost=function(){"use strict";if(!this.$FBRTCMozStatsReport0)return 0;return this.$FBRTCMozStatsReport0.inbound.packetsLost;};j.prototype.setVideoPacketsLost=function(k){"use strict";};j.prototype.videoPacketsLost=function(){"use strict";if(!this.$FBRTCMozStatsReport1)return 0;return this.$FBRTCMozStatsReport1.inbound.packetsLost;};j.prototype.audioBytesSent=function(){"use strict";if(!this.$FBRTCMozStatsReport0)return 0;return this.$FBRTCMozStatsReport0.outbound.bytesSent;};j.prototype.videoBytesSent=function(){"use strict";if(!this.$FBRTCMozStatsReport1)return 0;return this.$FBRTCMozStatsReport1.outbound.bytesSent;};j.prototype.audioPacketsSent=function(){"use strict";if(!this.$FBRTCMozStatsReport0)return 0;return this.$FBRTCMozStatsReport0.outbound.packetsSent;};j.prototype.videoPacketsSent=function(){"use strict";if(!this.$FBRTCMozStatsReport1)return 0;return this.$FBRTCMozStatsReport1.outbound.packetsSent;};j.prototype.videoFrameRateSent=function(){"use strict";if(!this.$FBRTCMozStatsReport1)return 0;return this.$FBRTCMozStatsReport1.outbound.framerateMean;};j.prototype.videoFrameRateCaptured=function(){"use strict";if(!this.$FBRTCMozStatsReport1)return 0;return 30;};j.prototype.connectionType=function(){"use strict";var k='unknown',l='unknown',m='unknown',n='unknown';this.candidatePairs.forEach(function(o){var p=this.candidates.get(o.localCandidateId),q=this.candidates.get(o.remoteCandidateId);k=p.transport;m=q.transport;l=p.candidateType;n=q.candidateType;}.bind(this));return i.connectionType(l,k,n,m);};e.exports=j;},null);
__d("FBRTCChromeStatsReport",["FBRTCStatsHelpers"],function(a,b,c,d,e,f,g){var h=function(j,k){return parseInt(j.stat(k),10);};function i(){"use strict";this.$FBRTCChromeStatsReport0=[];this.$FBRTCChromeStatsReport1=null;this.$FBRTCChromeStatsReport2=null;this.$FBRTCChromeStatsReport3=null;this.$FBRTCChromeStatsReport4=null;this.$FBRTCChromeStatsReport5=null;}i.prototype.parseReport=function(j){"use strict";j.result().forEach(function(k){if(k.type==="googCandidatePair"&&k.stat('googActiveConnection')==='true')this.$FBRTCChromeStatsReport0.push(k);if(this.$FBRTCChromeStatsReport6(k))this.$FBRTCChromeStatsReport1=k;if(this.$FBRTCChromeStatsReport7(k))this.$FBRTCChromeStatsReport2=k;if(this.$FBRTCChromeStatsReport8(k))this.$FBRTCChromeStatsReport3=k;if(this.$FBRTCChromeStatsReport9(k))this.$FBRTCChromeStatsReport4=k;if(k.type==='VideoBwe')this.$FBRTCChromeStatsReport5=k;}.bind(this));};i.prototype.isConnected=function(){"use strict";return true;};i.prototype.audioRtt=function(){"use strict";if(!this.$FBRTCChromeStatsReport1)return 0;return h(this.$FBRTCChromeStatsReport1,'googRtt');};i.prototype.videoRtt=function(){"use strict";if(!this.$FBRTCChromeStatsReport2)return 0;return h(this.$FBRTCChromeStatsReport2,'googRtt');};i.prototype.audioCodec=function(){"use strict";if(!this.$FBRTCChromeStatsReport1)return 'unknown';return this.$FBRTCChromeStatsReport1.stat('googCodecName');};i.prototype.videoCodec=function(){"use strict";if(!this.$FBRTCChromeStatsReport2)return 'unknown';return this.$FBRTCChromeStatsReport2.stat('googCodecName');};i.prototype.audioPacketsLost=function(){"use strict";if(!this.$FBRTCChromeStatsReport1)return 0;return h(this.$FBRTCChromeStatsReport1,'packetsLost');};i.prototype.setVideoPacketsLost=function(j){"use strict";this.$FBRTCChromeStatsReporta=j;};i.prototype.videoPacketsLost=function(){"use strict";if(!this.$FBRTCChromeStatsReport2)return 0;if(this.$FBRTCChromeStatsReporta)return this.$FBRTCChromeStatsReporta;return h(this.$FBRTCChromeStatsReport2,'packetsLost');};i.prototype.audioBytesSent=function(){"use strict";if(!this.$FBRTCChromeStatsReport1)return 0;return h(this.$FBRTCChromeStatsReport1,'bytesSent');};i.prototype.videoBytesSent=function(){"use strict";if(!this.$FBRTCChromeStatsReport2)return 0;return h(this.$FBRTCChromeStatsReport2,'bytesSent');};i.prototype.audioPacketsSent=function(){"use strict";if(!this.$FBRTCChromeStatsReport1)return 0;return h(this.$FBRTCChromeStatsReport1,'packetsSent');};i.prototype.videoPacketsSent=function(){"use strict";if(!this.$FBRTCChromeStatsReport2)return 0;return h(this.$FBRTCChromeStatsReport2,'packetsSent');};i.prototype.videoFrameRateSent=function(){"use strict";if(!this.$FBRTCChromeStatsReport2)return 0;return h(this.$FBRTCChromeStatsReport2,'googFrameRateSent');};i.prototype.videoFrameRateCaptured=function(){"use strict";if(!this.$FBRTCChromeStatsReport2)return 0;return h(this.$FBRTCChromeStatsReport2,'googFrameRateInput');};i.prototype.connectionType=function(){"use strict";var j='unknown',k='unknown',l='unknown';for(var m=0;m<this.$FBRTCChromeStatsReport0.length;m++){var n=this.$FBRTCChromeStatsReport0[m];k=n.stat('googLocalCandidateType');l=n.stat('googRemoteCandidateType');j=n.stat('googTransportType');}return g.connectionType(k,j,l,j);};i.prototype.$FBRTCChromeStatsReport6=function(j){"use strict";return j.type==='ssrc'&&j.names().indexOf('audioInputLevel')>-1;};i.prototype.$FBRTCChromeStatsReport7=function(j){"use strict";return j.type==='ssrc'&&j.names().indexOf('googFrameHeightInput')>-1;};i.prototype.$FBRTCChromeStatsReport8=function(j){"use strict";return j.type==='ssrc'&&j.names().indexOf('audioOutputLevel')>-1;};i.prototype.$FBRTCChromeStatsReport9=function(j){"use strict";return j.type==='ssrc'&&j.names().indexOf('googFrameHeightReceived')>-1;};e.exports=i;},null);
__d("FBRTCStatsReportFactory",["FBRTCMozStatsReport","FBRTCChromeStatsReport","FBRTCLogger","FBRTCVersionDetection"],function(a,b,c,d,e,f,g,h,i,j){var k=function(n,o){n.getStats(null,function(p){var q=new g();q.parseReport(p);o(q);},function(){i.getInstance().logToConsole('Firefox stats collection failed');});},l=function(n,o){n.getStats(function(p){var q=new h();q.parseReport(p);o(q);});},m={getStats:function(n,o){if(j.isFirefox())k(n,o);if(j.isChrome())l(n,o);}};e.exports=m;},null);
__d("FBRTCCallConnection",["mixInEventEmitter","FBRTCLogger","FBRTCPCConfig","FBRTCSdpUtils","FBRTCStatsReportFactory"],function(a,b,c,d,e,f,g,h,i,j,k){var l=300000,m=12000,n=10000;function o(){"use strict";this.$FBRTCCallConnection0=h.getInstance();this.$FBRTCCallConnection1();this.$FBRTCCallConnection2=null;this.$FBRTCCallConnection3=null;this.$FBRTCCallConnection4=null;this.$FBRTCCallConnection5=false;this.$FBRTCCallConnection6=0;}o.prototype.init=function(p){"use strict";this.$FBRTCCallConnection0.logToConsole('Creating a new peer connection with: '+JSON.stringify(i.getConfig())+', '+JSON.stringify(i.getConstraints()));this.$FBRTCCallConnection7=p;};o.prototype.setStream=function(p){"use strict";this.$FBRTCCallConnection7=p;};o.prototype.$FBRTCCallConnection8=function(p,q){"use strict";p.onaddstream=null;p.onremovestream=null;p.onicecandidate=null;p.oniceconnectionstatechange=null;var r=q?5000:1;setTimeout(function(){if(p.iceConnectionState!=='closed')p.close();},r);};o.prototype.$FBRTCCallConnection9=function(){"use strict";if(this.$FBRTCCallConnection2)this.$FBRTCCallConnection8(this.$FBRTCCallConnection2,true);var p=new this.nativePeerConnection(i.getConfig(),i.getConstraints());p.onaddstream=this.$FBRTCCallConnectiona.bind(this);p.onremovestream=this.$FBRTCCallConnectionb.bind(this);p.onicecandidate=this.$FBRTCCallConnectionc.bind(this);p.oniceconnectionstatechange=this.$FBRTCCallConnectiond.bind(this);p.addStream(this.$FBRTCCallConnection7.getStream());return p;};o.prototype.createOffer=function(){"use strict";this.$FBRTCCallConnection2=this.$FBRTCCallConnection9();this.$FBRTCCallConnection2.createOffer(this.$FBRTCCallConnectione.bind(this),this.$FBRTCCallConnectionf.bind(this,'CreateOfferFailed'),{mandatory:{OfferToReceiveAudio:true,OfferToReceiveVideo:true}});};o.prototype.end=function(){"use strict";this.$FBRTCCallConnection0.logToConsole('Ending connection...');if(this.$FBRTCCallConnection2){this.emit('isEnding');this.$FBRTCCallConnection8(this.$FBRTCCallConnection2,false);this.$FBRTCCallConnection2=null;}};o.prototype.onReceivedOfferSDP=function(p){"use strict";this.$FBRTCCallConnection2=this.$FBRTCCallConnection9();var q=new this.nativeSessionDescription({type:'offer',sdp:p});this.$FBRTCCallConnection2.setRemoteDescription(q,this.$FBRTCCallConnectiong.bind(this,q),this.$FBRTCCallConnectionf.bind(this,'SetRemoteOfferFailed'));};o.prototype.onReceivedAnswerSDP=function(p){"use strict";var q=new this.nativeSessionDescription({type:'answer',sdp:p});this.$FBRTCCallConnection2.setRemoteDescription(q,this.$FBRTCCallConnectiong.bind(this,q),this.$FBRTCCallConnectionf.bind(this,'SetRemoteAnswerFailed'));};o.prototype.onReceivedRemoteIceCandidate=function(p){"use strict";var q=new this.nativeIceCandidate({sdpMLineIndex:p.label,candidate:p.sdp,sdpMid:p.sdp_mid});this.$FBRTCCallConnection2.addIceCandidate(q);};o.prototype.getStats=function(p){"use strict";k.getStats(this.$FBRTCCallConnection2,p);};o.prototype.$FBRTCCallConnectione=function(p){"use strict";this.$FBRTCCallConnection0.logToConsole('Created '+p.type+' sdp');if(!this.$FBRTCCallConnection2){this.$FBRTCCallConnection0.logToConsole('_onSDPCreated: pc has been deallocated');return;}p.sdp=j.addIceOptionToSdp(p.sdp,"fb-force-5245");p.sdp=j.preferIsac(p.sdp);this.$FBRTCCallConnection2.setLocalDescription(p,this.$FBRTCCallConnectionh.bind(this,p),this.$FBRTCCallConnectionf.bind(this,(p.type==='offer')?'SetLocalOfferFailed':'SetAnswerFailed'));};o.prototype.$FBRTCCallConnectionh=function(p){"use strict";if(p.type==='offer'){this.emit('offerSDPCreated',p.sdp);}else this.emit('answerSDPCreated',p.sdp);this.$FBRTCCallConnection0.logToConsole('Local '+p.type+' set');};o.prototype.$FBRTCCallConnectiong=function(p){"use strict";this.$FBRTCCallConnection0.logToConsole('Remote '+p.type+' set');if(!this.$FBRTCCallConnection2){this.$FBRTCCallConnection0.logToConsole('_onRemoteDescriptionSet: pc has been deallocated');return;}if(p.type==='offer')this.$FBRTCCallConnection2.createAnswer(this.$FBRTCCallConnectione.bind(this),this.$FBRTCCallConnectionf.bind(this,'CreateAnswerFailed'));this.emit('remoteDescriptionSet');};o.prototype.$FBRTCCallConnectiona=function(event){"use strict";this.$FBRTCCallConnection0.logToConsole('Remote stream added');this.emit('remoteStreamAdded',{stream:event.stream});};o.prototype.$FBRTCCallConnectionb=function(event){"use strict";this.$FBRTCCallConnection0.logToConsole('Remote stream removed');};o.prototype.$FBRTCCallConnectionc=function(event){"use strict";if(event.candidate)this.emit('localIceCandidateCreated',event.candidate);};o.prototype.$FBRTCCallConnectiond=function(event){"use strict";var p=event.target.iceConnectionState;this.$FBRTCCallConnection0.logToConsole('Ice candidate state changed from '+this.$FBRTCCallConnection3+' to '+p);if(p===this.$FBRTCCallConnection3)return;this.$FBRTCCallConnectioni();if(this.$FBRTCCallConnectionj(p)){if(!this.$FBRTCCallConnection5){this.emit('connected');this.$FBRTCCallConnection5=true;}}else if(p==='disconnected'){this.$FBRTCCallConnectionk();}else if(p==='failed')this.$FBRTCCallConnectionl();this.$FBRTCCallConnection3=p;};o.prototype.$FBRTCCallConnectionj=function(p){"use strict";return (p==='completed'||p==='connected');};o.prototype.$FBRTCCallConnectionk=function(){"use strict";if(this.$FBRTCCallConnectionj(this.$FBRTCCallConnection3)){var p=Date.now();if(this.$FBRTCCallConnectionm-p>=l)this.$FBRTCCallConnection6=0;this.$FBRTCCallConnection6=this.$FBRTCCallConnection6+1;this.$FBRTCCallConnectionm=p;if(this.$FBRTCCallConnection6>=2)this.emit('connectionUnstable');}var q=this;this.$FBRTCCallConnection4=setTimeout(function(){q.emit('disconnected');},m);};o.prototype.$FBRTCCallConnectionl=function(){"use strict";var p=this;this.$FBRTCCallConnection4=setTimeout(function(){var q={details:'Ice candidate state failed',endCallSubreason:'IceFailed'};p.emit('connectionError',q);},n);};o.prototype.$FBRTCCallConnectioni=function(){"use strict";if(this.$FBRTCCallConnection4)clearTimeout(this.$FBRTCCallConnection4);this.$FBRTCCallConnection4=null;};o.prototype.$FBRTCCallConnectionf=function(p,q){"use strict";var r={details:q,endCallSubreason:p};this.emit('connectionError',r);};o.prototype.$FBRTCCallConnection1=function(){"use strict";if(window.webkitRTCPeerConnection){this.$FBRTCCallConnection0.logToConsole('Using Chrome WebRTC APIs...');this.nativePeerConnection=window.webkitRTCPeerConnection;this.nativeIceCandidate=window.RTCIceCandidate;this.nativeSessionDescription=window.RTCSessionDescription;}else{this.$FBRTCCallConnection0.logToConsole('Using Firefox WebRTC APIs...');this.nativePeerConnection=window.mozRTCPeerConnection;this.nativeIceCandidate=window.mozRTCIceCandidate;this.nativeSessionDescription=window.mozRTCSessionDescription;}};g(o,{remoteStreamAdded:true,offerSDPCreated:true,answerSDPCreated:true,localIceCandidateCreated:true,remoteDescriptionSet:true,connected:true,disconnected:true,connectionUnstable:true,connectionError:true,isEnding:true});e.exports=o;},null);
__d("RingBuffer",[],function(a,b,c,d,e,f){function g(h){"use strict";this.$RingBuffer0=h;this.$RingBuffer1=-1;this.$RingBuffer2=[];}g.prototype.add=function(h){"use strict";this.$RingBuffer1=(this.$RingBuffer1+1)%this.$RingBuffer0;this.$RingBuffer2[this.$RingBuffer1]=h;};g.prototype.size=function(){"use strict";return this.$RingBuffer2.length;};g.prototype.head=function(){"use strict";if(this.$RingBuffer1===-1)return null;return this.$RingBuffer2[this.$RingBuffer1];};g.prototype.tail=function(){"use strict";if(this.$RingBuffer1===-1)return null;return this.$RingBuffer2[this.$RingBuffer3()];};g.prototype.forEach=function(h){"use strict";for(var i=0;i<this.$RingBuffer2.length;i++){var j=(this.$RingBuffer1+1+i)%this.$RingBuffer2.length;h(this.$RingBuffer2[j]);}};g.prototype.$RingBuffer3=function(){"use strict";return (this.$RingBuffer1+1)%this.$RingBuffer2.length;};e.exports=g;},null);
__d("FBRTCRttAggregator",[],function(a,b,c,d,e,f){function g(){"use strict";this.$FBRTCRttAggregator0=[{count:0,ave:0},{count:0,ave:0},{count:0,ave:0},{count:0,ave:0}];}g.prototype.addRtt=function(h){"use strict";var i=this.$FBRTCRttAggregator0[this.$FBRTCRttAggregator1(h)];i.ave=this.$FBRTCRttAggregator2(i.ave,i.count,h);i.count+=1;};g.prototype.toString=function(){"use strict";return [this.$FBRTCRttAggregator3('50',this.$FBRTCRttAggregator0[0]),this.$FBRTCRttAggregator3('100',this.$FBRTCRttAggregator0[1]),this.$FBRTCRttAggregator3('200',this.$FBRTCRttAggregator0[2]),this.$FBRTCRttAggregator3('0',this.$FBRTCRttAggregator0[3])].join('|');};g.prototype.$FBRTCRttAggregator3=function(h,i){"use strict";return (h+"="+i.count+","+Math.round(i.ave));};g.prototype.$FBRTCRttAggregator1=function(h){"use strict";if(h<50)return 0;if(h<100)return 1;if(h<200)return 2;return 3;};g.prototype.$FBRTCRttAggregator2=function(h,i,j){"use strict";return (h*i+j)/(i+1);};e.exports=g;},null);
__d("FBRTCStatsInterpreter",["FBRTCLogger"],function(a,b,c,d,e,f,g){var h={rtt_weight:2,frr_weight:800,plr_weight:500,score_threshold:1000,bad_score_count:3};function i(j){"use strict";this.$FBRTCStatsInterpreter0=Object.assign({},h,j||{});this.$FBRTCStatsInterpreter1=g.getInstance();this.$FBRTCStatsInterpreter2=0;}i.prototype.interpretStats=function(j,k){"use strict";var l=j.videoRtt(),m=this.$FBRTCStatsInterpreter3(j),n=this.$FBRTCStatsInterpreter4(j,k),o=this.$FBRTCStatsInterpreter5(l,m,n);this.$FBRTCStatsInterpreter1.logToConsole('the current network score is: '+o);if(o>=this.$FBRTCStatsInterpreter0.score_threshold&&!this.isNetworkPoor())this.$FBRTCStatsInterpreter2+=1;if(o<this.$FBRTCStatsInterpreter0.score_threshold&&this.$FBRTCStatsInterpreter2>0)this.$FBRTCStatsInterpreter2-=1;this.$FBRTCStatsInterpreter1.logToConsole('the bad score count is: '+this.$FBRTCStatsInterpreter2);};i.prototype.isNetworkPoor=function(){"use strict";return this.$FBRTCStatsInterpreter2>=this.$FBRTCStatsInterpreter0.bad_score_count;};i.prototype.$FBRTCStatsInterpreter5=function(j,k,l){"use strict";return j*this.$FBRTCStatsInterpreter0.rtt_weight+k*this.$FBRTCStatsInterpreter0.frr_weight+l*this.$FBRTCStatsInterpreter0.plr_weight;};i.prototype.$FBRTCStatsInterpreter4=function(j,k){"use strict";var l,m;if(k){l=j.videoPacketsLost()-k.videoPacketsLost();m=j.videoPacketsSent()-k.videoPacketsSent();}else{l=j.videoPacketsLost();m=j.videoPacketsSent();}if(l<0||m===0)return 0;return (l/m);};i.prototype.$FBRTCStatsInterpreter3=function(j){"use strict";if(j.videoFrameRateCaptured()===0)return 0;return 1-(j.videoFrameRateSent()/j.videoFrameRateCaptured());};e.exports=i;},null);
__d("FBRTCCallConnectionMonitor",["RingBuffer","FBRTCRttAggregator","FBRTCStatsInterpreter","FBRTCConfig","mixInEventEmitter"],function(a,b,c,d,e,f,g,h,i,j,k){var l=3000,m=1,n=0,o=3;function p(q,r){"use strict";this.$FBRTCCallConnectionMonitor0=new i(j.statsInterpreterConfig());this.$FBRTCCallConnectionMonitor1=new h();this.$FBRTCCallConnectionMonitor2=new h();this.$FBRTCCallConnectionMonitor3=q;this.$FBRTCCallConnectionMonitor4=r;this.$FBRTCCallConnectionMonitor5=null;this.$FBRTCCallConnectionMonitor6=[];this.$FBRTCCallConnectionMonitor7=new g(m);this.$FBRTCCallConnectionMonitor8=0;this.$FBRTCCallConnectionMonitor3.addListener('connected',this.$FBRTCCallConnectionMonitor9,this);this.$FBRTCCallConnectionMonitor3.addListener('isEnding',this.$FBRTCCallConnectionMonitora,this);}p.prototype.$FBRTCCallConnectionMonitor9=function(){"use strict";var q=this.$FBRTCCallConnectionMonitorb.bind(this);this.$FBRTCCallConnectionMonitor5=setInterval(q,l);this.$FBRTCCallConnectionMonitorb();};p.prototype.$FBRTCCallConnectionMonitora=function(){"use strict";if(this.$FBRTCCallConnectionMonitor5!==null){this.$FBRTCCallConnectionMonitorb();clearInterval(this.$FBRTCCallConnectionMonitor5);this.$FBRTCCallConnectionMonitor5=null;}};p.prototype.$FBRTCCallConnectionMonitorb=function(){"use strict";this.$FBRTCCallConnectionMonitor3.getStats(function(q){var r;if(this.$FBRTCCallConnectionMonitor7.size()>0){r=this.$FBRTCCallConnectionMonitor7.head();this.$FBRTCCallConnectionMonitorc(q,r);}if(this.$FBRTCCallConnectionMonitor6.length<n)this.$FBRTCCallConnectionMonitor6.push(q);if(r&&r.isConnected()&&!q.isConnected())this.$FBRTCCallConnectionMonitor8+=1;if(this.$FBRTCCallConnectionMonitor8>=o)this.$FBRTCCallConnectionMonitor3.emit('disconnected');if(q.isConnected()){this.$FBRTCCallConnectionMonitor8=0;this.$FBRTCCallConnectionMonitor7.add(q);this.$FBRTCCallConnectionMonitor1.addRtt(q.audioRtt());this.$FBRTCCallConnectionMonitor2.addRtt(q.videoRtt());this.$FBRTCCallConnectionMonitor4.setPcStats(this.$FBRTCCallConnectionMonitord());this.$FBRTCCallConnectionMonitore(q,r);}}.bind(this));};p.prototype.$FBRTCCallConnectionMonitord=function(){"use strict";var q=this.$FBRTCCallConnectionMonitor7.head();return {end:{conn_type:q.connectionType()},sender:{bytes:q.audioBytesSent(),codec:{'0':q.audioCodec()},plost:q.audioPacketsLost(),psent:q.audioPacketsSent(),rtt:this.$FBRTCCallConnectionMonitor1.toString()},video:{sender:{bytes:q.videoBytesSent(),codec:{'0':q.videoCodec()},plost:q.videoPacketsLost(),psent:q.videoPacketsSent(),rtt:this.$FBRTCCallConnectionMonitor2.toString()}}};};p.prototype.$FBRTCCallConnectionMonitorc=function(q,r){"use strict";if(r.videoPacketsLost()>q.videoPacketsLost())q.setVideoPacketsLost(r.videoPacketsLost());};p.prototype.$FBRTCCallConnectionMonitore=function(q,r){"use strict";this.$FBRTCCallConnectionMonitor0.interpretStats(q,r);if(this.$FBRTCCallConnectionMonitor0.isNetworkPoor())this.emit('connectionPoor');};k(p,{connectionPoor:true});e.exports=p;},null);
__d("FBRTCFullScreenController",[],function(a,b,c,d,e,f){var g,h,i=document.documentElement;if(i.requestFullscreen){g=i.requestFullscreen.bind(i);h='fullscreenchange';}else if(i.msRequestFullscreen){g=i.msRequestFullscreen.bind(i);h='msfullscreenchange';}else if(i.mozRequestFullScreen){g=i.mozRequestFullScreen.bind(i);h='mozfullscreenchange';}else if(i.webkitRequestFullscreen){g=i.webkitRequestFullscreen.bind(i,Element.ALLOW_KEYBOARD_INPUT);h='webkitfullscreenchange';}var j;if(document.exitFullscreen){j=document.exitFullscreen.bind(document);}else if(document.msExitFullscreen){j=document.msExitFullscreen.bind(document);}else if(document.mozCancelFullScreen){j=document.mozCancelFullScreen.bind(document);}else if(document.webkitExitFullscreen)j=document.webkitExitFullscreen.bind(document);var k={supportsFullScreen:function(){return g&&j;},isFullScreen:function(){return (document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement);},toggleFullScreen:function(){if(this.isFullScreen()){j();}else g();},onFullScreenChange:function(l){document.addEventListener(h,l);}};e.exports=k;},null);
__d("XVideoCallUserInfoControllerURIBuilder",["XControllerURIBuilder"],function(a,b,c,d,e,f){e.exports=b("XControllerURIBuilder").create("\/videocall\/userinfo\/",{user_id:{type:"Int",required:true}});},null);
__d("FBRTCPeerInfo",["ix","XVideoCallUserInfoControllerURIBuilder","FBRTCUtils"],function(a,b,c,d,e,f,g,h,i){function j(k){"use strict";this.peerID=k;this.peerPicUrl=null;this.selfPicUrl=g('/images/chat/webrtc/no_profile_pic.png');this.backgroundUrl=null;this.peerName='';}j.prototype.fetch=function(k,l){"use strict";var m=(new h()).setInt('user_id',this.peerID).getURI(),n=this;i.sendServerRequest(m,function(o){n.peerPicUrl=o.payload.profile_pic_url;n.backgroundUrl=o.payload.cover_pic_url;n.peerName=o.payload.name;if(o.payload.self_profile_pic_url)n.selfPicUrl=o.payload.self_profile_pic_url;if(k)k();},l);};e.exports=j;},null);
__d("FBRTCStreamWrapper",["mixInEventEmitter","FBRTCUtils"],function(a,b,c,d,e,f,g,h){var i=100;function j(){"use strict";this.$FBRTCStreamWrapper0=true;this.$FBRTCStreamWrapper1=true;this.$FBRTCStreamWrapper2=null;this.$FBRTCStreamWrapper3=null;this.aspectRatio=j.aspectRatios.other;this.videoWidth=0;this.videoHeight=0;}j.prototype.setStream=function(k){"use strict";this.$FBRTCStreamWrapper2=k;this.$FBRTCStreamWrapper4();this.$FBRTCStreamWrapper2.onaddtrack=this.$FBRTCStreamWrapper5.bind(this);this.$FBRTCStreamWrapper2.onremovetrack=this.$FBRTCStreamWrapper5.bind(this);this.$FBRTCStreamWrapper2.onended=this.$FBRTCStreamWrapper6.bind(this);};j.prototype.getStream=function(){"use strict";return this.$FBRTCStreamWrapper2;};j.prototype.hasStream=function(){"use strict";return !!this.$FBRTCStreamWrapper2;};j.prototype.hasVideoTracks=function(){"use strict";if(this.$FBRTCStreamWrapper2)return this.$FBRTCStreamWrapper2.getVideoTracks().length>0;return true;};j.prototype.hasVideo=function(){"use strict";return this.$FBRTCStreamWrapper1&&this.hasVideoTracks();};j.prototype.hasAudio=function(){"use strict";return this.$FBRTCStreamWrapper0;};j.prototype.attachToVideoTag=function(k){"use strict";this.$FBRTCStreamWrapper3=k;h.attachMediaStream(k,this.$FBRTCStreamWrapper2);this.$FBRTCStreamWrapper7(k);};j.prototype.toggleMuteAudio=function(){"use strict";var k=this.$FBRTCStreamWrapper2.getAudioTracks();this.$FBRTCStreamWrapper0=!this.$FBRTCStreamWrapper0;for(var l=0;l<k.length;l++)k[l].enabled=this.$FBRTCStreamWrapper0;};j.prototype.toggleMuteVideo=function(){"use strict";this.$FBRTCStreamWrapper1=!this.$FBRTCStreamWrapper1;if(this.$FBRTCStreamWrapper1){this.$FBRTCStreamWrapper4();}else setTimeout(this.$FBRTCStreamWrapper4.bind(this),500);this.$FBRTCStreamWrapper5();};j.prototype.$FBRTCStreamWrapper4=function(){"use strict";if(this.$FBRTCStreamWrapper2){var k=this.$FBRTCStreamWrapper2.getVideoTracks();for(var l=0;l<k.length;l++)k[l].enabled=this.$FBRTCStreamWrapper1;}};j.prototype.setVideoEnabled=function(k){"use strict";this.$FBRTCStreamWrapper1=k;this.$FBRTCStreamWrapper4();this.$FBRTCStreamWrapper5();};j.prototype.$FBRTCStreamWrapper7=function(k){"use strict";if(!this.hasVideo()||k.currentTime>0){this.$FBRTCStreamWrapper8(k);}else setTimeout(this.$FBRTCStreamWrapper7.bind(this,k),i);};j.prototype.$FBRTCStreamWrapper9=function(k){"use strict";this.videoWidth=k.videoWidth;this.videoHeight=k.videoHeight;var l=k.videoWidth/k.videoHeight;if(h.aboutEqual(l,(16/9)))return j.aspectRatios['16:9'];if(h.aboutEqual(l,(4/3)))return j.aspectRatios['4:3'];return j.aspectRatios.other;};j.prototype.$FBRTCStreamWrapper8=function(k){"use strict";if(this.hasVideo()){this.aspectRatio=this.$FBRTCStreamWrapper9(k);}else this.aspectRatio=j.aspectRatios.other;this.emit('streamStarted');};j.prototype.$FBRTCStreamWrapper6=function(){"use strict";this.emit('streamEnded');};j.prototype.$FBRTCStreamWrapper5=function(event){"use strict";if(this.$FBRTCStreamWrappera(event))this.attachToVideoTag(this.$FBRTCStreamWrapper3);this.emit('tracksChanged');};j.prototype.$FBRTCStreamWrappera=function(k){"use strict";return this.$FBRTCStreamWrapper3&&k&&k.type==='addtrack'&&k.track.kind==='video';};j.aspectRatios={'16:9':1,'4:3':2,other:3};g(j,{streamStarted:true,streamEnded:true,tracksChanged:true});e.exports=j;},null);
__d("FBRTCCallModel",["mixInEventEmitter","FBRTCFullScreenController","FBRTCLogger","FBRTCPCConfig","FBRTCPeerInfo","FBRTCStreamWrapper","FBRTCStruct"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){function n(o){"use strict";this.$FBRTCCallModel0=i.getInstance();this.isCaller=o.isCaller;this.peerID=o.peerID;this.$FBRTCCallModel1=new k(o.peerID);this.$FBRTCCallModel2(o.callID);this.$FBRTCCallModel3(true);}n.prototype.resetForReconnect=function(o){"use strict";this.isCaller=false;this.$FBRTCCallModel2(o);this.$FBRTCCallModel3(false);};n.prototype.fetchPeerInfo=function(){"use strict";var o=this,p=function(){o.emit('changed');},q=function(){o.$FBRTCCallModel0.logError(o.peerID,o.callID,'Failed to get remote photos');};this.$FBRTCCallModel1.fetch(p,q);};n.prototype.$FBRTCCallModel2=function(o){"use strict";this.callID=o;this.startTime=new Date();this.endCallReason=null;this.isRemoteEnded=null;this.wasConnected=false;this.receivedNack=false;this.isRemoteVideoSupported=false;this.$FBRTCCallModel4=true;this.$FBRTCCallModel5=false;};n.prototype.$FBRTCCallModel3=function(o){"use strict";if(o){this.localStream=new l();this.localStream.addListener('tracksChanged',function(){if(!this.$FBRTCCallModel4&&this.localStream.hasVideo())this.$FBRTCCallModel5=true;this.emit('changed');}.bind(this));}this.remoteStream=new l();this.selfViewOpen=true;this.uiState=n.UIState.INIT;this.emit('changed');};n.prototype.setLocalStream=function(o){"use strict";this.localStream.setStream(o);};n.prototype.setRemoteStream=function(o){"use strict";this.remoteStream.setStream(o);};n.prototype.canStartCall=function(){"use strict";return this.localStream.hasStream()&&j.turnIP;};n.prototype.isInProgress=function(){"use strict";return this.uiState>=n.UIState.CONTACTING&&this.uiState<n.UIState.CALL_ENDED;};n.prototype.isUserMediaPending=function(){"use strict";return this.uiState===n.UIState.PENDING_LOCAL_MEDIA;};n.prototype.isUserMediaDenied=function(){"use strict";return this.uiState===n.UIState.USER_MEDIA_DENIED;};n.prototype.isEnded=function(){"use strict";return this.uiState>=n.UIState.CALL_ENDED;};n.prototype.isFullScreen=function(){"use strict";return h.isFullScreen();};n.prototype.peerPicUrl=function(){"use strict";return this.$FBRTCCallModel1.peerPicUrl;};n.prototype.selfPicUrl=function(){"use strict";return this.$FBRTCCallModel1.selfPicUrl;};n.prototype.backgroundUrl=function(){"use strict";return this.$FBRTCCallModel1.backgroundUrl;};n.prototype.peerName=function(){"use strict";return this.$FBRTCCallModel1.peerName;};n.prototype.autoDisableVideo=function(){"use strict";if(this.$FBRTCCallModel4){this.$FBRTCCallModel4=false;this.$FBRTCCallModel0.logCallAction(this.peerID,this.callID,i.CallAction.AUTO_DISABLE_VIDEO);this.localStream.setVideoEnabled(false);}};n.prototype.videoIsAutoDisabled=function(){"use strict";return !this.$FBRTCCallModel4&&!this.$FBRTCCallModel5&&!this.localStream.hasVideo();};n.prototype.setState=function(o){"use strict";if(o===this.uiState)return;var p=this.uiState;this.uiState=o;if(o===n.UIState.CALL_CONNECTED)this.wasConnected=true;this.$FBRTCCallModel0.logInfo(this.peerID,this.callID,'UI: state change - "'+n.UIState.strNames[p]+'" to "'+n.UIState.strNames[o]+'"');this.emit('changed',this.uiState);};n.prototype.setStateFrom=function(o,p){"use strict";if(this.uiState===o){this.setState(p);}else this.$FBRTCCallModel0.logInfo(this.peerID,this.callID,'UI: Not at "'+n.UIState.strNames[o]+'", not moving to "'+n.UIState.strNames[p]+'"');};n.UIState=new m(['INIT','PENDING_LOCAL_MEDIA','USER_MEDIA_DENIED','MORE_INIT','CONTACTING','RINGING','CALL_CONNECTING','CALL_CONNECTED','CALL_ENDED','COLLECT_RATING']);g(n,{changed:true});e.exports=n;},null);
__d("FBRTCCallMonitor",["FBRTCCallSummaryStore"],function(a,b,c,d,e,f,g){var h=10000,i=3000;function j(k){"use strict";this.$FBRTCCallMonitor0=k;this.$FBRTCCallMonitor1=null;this.$FBRTCCallMonitor2=g.getInstance();}j.prototype.startHeartbeat=function(k){"use strict";if(this.$FBRTCCallMonitor0.isEnded())return;var l=k();if(l)this.onCallHeartbeat(l);var m=this;setTimeout(function(){m.startHeartbeat(k);},h);};j.prototype.onCallHeartbeat=function(k){"use strict";var l=(new Date()).valueOf();if(!this.$FBRTCCallMonitor1||(l-this.$FBRTCCallMonitor1)>i)k.save(this.$FBRTCCallMonitor2);};e.exports=j;},null);
__d("FBRTCTurnDiscovery",["FBRTCLogger","FBRTCUtils","XVideoCallTurnDiscoveryControllerURIBuilder","mixInEventEmitter"],function(a,b,c,d,e,f,g,h,i,j){var k=3,l={requestTurnCreds:function(m,n){if(this._turnCreds)this.emit('receivedTurnCreds',this._turnCreds);if(n===(void 0))n=k;var o=1,p=(new i()).setInt('version',o).getURI();h.sendServerRequest(p,this._onServerRequestSuccess.bind(this),this._onServerRequestFailure.bind(this,m,n));},_onServerRequestSuccess:function(m){this._turnCreds=m.payload;this.emit('receivedTurnCreds',this._turnCreds);},_onServerRequestFailure:function(m,n,o){if(n>0){g.getInstance().logError(m.peerID,m.callID,'Failed turn; going to retry');this.requestTurnCreds(m,n-1);}else this.emit('failed');}};j(l,{receivedTurnCreds:true,failed:true});e.exports=l;},null);
__d("FBRTCStreamTester",["mixInEventEmitter","FBRTCUtils"],function(a,b,c,d,e,f,g,h){var i=100,j=30;function k(l){"use strict";if(!l)l={};this.$FBRTCStreamTester0=l.retries||j;this.$FBRTCStreamTester1=l.testInterval||i;this.$FBRTCStreamTester2=null;this.$FBRTCStreamTester3=null;this.$FBRTCStreamTester4=false;}k.prototype.testStream=function(l,m){"use strict";this.$FBRTCStreamTester2=l;if(!m){this.$FBRTCStreamTester4=true;this.$FBRTCStreamTester3=document.createElement('video');this.$FBRTCStreamTester3.muted=true;h.attachMediaStream(this.$FBRTCStreamTester3,this.$FBRTCStreamTester2);this.$FBRTCStreamTester3.play();}else{this.$FBRTCStreamTester4=false;this.$FBRTCStreamTester3=m;}this.$FBRTCStreamTester5(this.$FBRTCStreamTester0);};k.prototype.$FBRTCStreamTester5=function(l){"use strict";if(this.$FBRTCStreamTester2.getVideoTracks().length===0||this.$FBRTCStreamTester3.currentTime>0){this.emit('streamWorking');this.$FBRTCStreamTester6();}else if(l<1){this.emit('streamBroken');this.$FBRTCStreamTester6();}else setTimeout(this.$FBRTCStreamTester5.bind(this,l-1),this.$FBRTCStreamTester1);};k.prototype.$FBRTCStreamTester6=function(){"use strict";if(this.$FBRTCStreamTester4)this.$FBRTCStreamTester3.pause();this.$FBRTCStreamTester3=null;this.$FBRTCStreamTester2=null;};g(k,{streamWorking:true,streamBroken:true});e.exports=k;},null);
__d("FBRTCUserMediaRequest",["mixInEventEmitter","FBRTCStruct"],function(a,b,c,d,e,f,g,h){var i=960,j=720,k=640,l=480,m=30,n=function(r,s){if(!r)return {audio:true,video:false};var t=s?i:k,u=s?j:l;return {audio:true,video:{mandatory:{},optional:[{maxWidth:t},{minWidth:t},{minHeight:u},{maxHeight:u},{minFrameRate:m},{maxFrameRate:m},{googLeakyBucket:true}]}};},o=function(r,s,t){if(navigator.getUserMedia){navigator.getUserMedia(r,s,t);}else if(navigator.webkitGetUserMedia){navigator.webkitGetUserMedia(r,s,t);}else if(navigator.mozGetUserMedia){navigator.mozGetUserMedia(r,s,t);}else if(navigator.msGetUserMedia)navigator.msGetUserMedia(r,s,t);},p=new h(['NO_VIDEO','SD_VIDEO','HD_VIDEO']);function q(r){"use strict";if(r===(void 0))r=p.SD_VIDEO;this.streamType=r;}q.prototype.request=function(){"use strict";var r=this.streamType!==p.NO_VIDEO,s=this.streamType===p.HD_VIDEO,t=n(r,s);o(t,function(u){this.emit('success',u);}.bind(this),function(u){this.emit('failed',u);}.bind(this));};q.STREAM_TYPE=p;q.HD_WIDTH=i;q.SD_WIDTH=k;g(q,{success:true,failed:true});e.exports=q;},null);
__d("FBRTCUserMedia",["mixInEventEmitter","FBRTCLogger","FBRTCStreamTester","FBRTCUserMediaRequest"],function(a,b,c,d,e,f,g,h,i,j){var k={STREAM_TYPE:j.STREAM_TYPE,_localStream:null,_accessGranted:false,_pendingRequest:null,requestUserMedia:function(l){if(this._localStream){this.emit('streamReady',this._localStream);}else{this._startRequestListeners();this._pendingRequest=new j(l);this._pendingRequest.addListener('success',this._onRequestSuccess,this);this._pendingRequest.addListener('failed',this._onRequestFailure,this);this._pendingRequest.request();}},end:function(){this._stopEventListeners();if(this._localStream)this._localStream.stop();},_startRequestListeners:function(){if(navigator.mozGetUserMedia){this._evListener=this._onMediaPromptHidden.bind(this);document.addEventListener('mousedown',this._evListener);document.addEventListener('focus',this._evListener);}},_stopEventListeners:function(){if(navigator.mozGetUserMedia){if(this._promptTimeout)clearTimeout(this._promptTimeout);document.removeEventListener('mousedown',this._evListener);document.removeEventListener('focus',this._evListener);}},_onMediaPromptHidden:function(){this._promptTimeout=setTimeout(function(){if(!this._accessGranted&&this._pendingRequest)this._pendingRequest.request();}.bind(this),1500);},_onRequestSuccess:function(l){this._stopEventListeners();if(!this._accessGranted){this._accessGranted=true;this.emit('accessGranted');}var m=new i();m.addListener('streamWorking',function(){this._pendingRequest=null;this._localStream=l;this.emit('streamReady',l);}.bind(this));m.addListener('streamBroken',function(){this._onRequestFailure('StreamFailedToStart');}.bind(this));m.testStream(l);},_onRequestFailure:function(l){this._stopEventListeners();var m=this._getErrorName(l);if(this._shouldRerequestWithoutVideo(m,this._pendingRequest)){this._pendingRequest.streamType=this.STREAM_TYPE.NO_VIDEO;this._pendingRequest.request();return;}if(m==='InvalidStateError'){h.getInstance().logErrorWithoutID('Invalid state while requesting user media');return;}this._pendingRequest=null;if(m==='PERMISSION_DENIED'||m==='PermissionDeniedError'||m==='PermissionDismissedError'){this.emit('accessDenied',m);}else{if(m==='NO_DEVICES_FOUND')m='DevicesNotFoundError';h.getInstance().logErrorWithoutID('getUserMedia error: '+m);this.emit('accessFailed',m);}},_getErrorName:function(l){if(l.name)return l.name;return l;},_shouldRerequestWithoutVideo:function(l,m){return m.streamType!==this.STREAM_TYPE.NO_VIDEO&&(l==='DevicesNotFoundError'||l==='StreamFailedToStart');}};g(k,{streamReady:true,accessGranted:true,accessDenied:true,accessFailed:true});e.exports=k;},null);
__d("FBRTCSettingsDialog.react",["React","fbt","Link.react","XUIDialog.react","XUIDialogBody.react","XUIDialogFooter.react","XUIDialogTitle.react","XUIDialogSaveButton.react","XUIDialogCancelButton.react","XUIGrayText.react","FBRTCConfig"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){var r=g.createClass({displayName:"FBRTCSettingsDialog",render:function(){return (g.createElement(j,{width:440,shown:true},g.createElement(m,{showCloseButton:true},g.createElement("span",null,"Settings")),g.createElement(k,null,this._dialogBody()),g.createElement(l,null,g.createElement(o,null),g.createElement(n,{use:"confirm"}))));},_dialogBody:function(){return (g.createElement("div",null,this._helpLink()));},_helpLink:function(){return (g.createElement("div",null,g.createElement(p,{shade:"light"},h._("Having Trouble? {troubleShootingGuideLink}",[h.param("troubleShootingGuideLink",g.createElement(i,{href:q.unsupportedBrowserUrl(),target:"_blank"},"Get help"))]))));}});e.exports=r;},null);
__d("FBRTCMediaAccessErrorDialog.react",["React","fbt","Link.react","XUIDialog.react","XUIDialogBody.react","XUIDialogFooter.react","XUIDialogTitle.react","FBRTCConfig"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){var o=g.createClass({displayName:"FBRTCMediaAccessErrorDialog",render:function(){return (g.createElement(j,{shown:true,width:440,layerHideOnBlur:false},g.createElement(m,{showCloseButton:false},g.createElement("span",null,"Can't Make Call")),g.createElement(k,null,this._dialogBody()),g.createElement(l,{leftContent:this._footerContent()})));},_dialogBody:function(){return (g.createElement("p",null,"Connect a camera and a microphone to make a call. If they're already connected, try restarting your browser and closing any other applications that use a camera or microphone."));},_footerContent:function(){return (g.createElement("span",null,h._("Still need help? See our {troubleShootingGuideLink}",[h.param("troubleShootingGuideLink",g.createElement(i,{href:n.userMediaErrorUrl(),target:"_blank"},"Troubleshooting Guide"))])));}});e.exports=o;},null);
__d("FBRTCPeerBrowserUnsupportedDialog.react",["React","fbt","Link.react","XUIDialog.react","XUIDialogBody.react","XUIDialogFooter.react","XUIDialogTitle.react","FBRTCConfig"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){var o=g.createClass({displayName:"FBRTCPeerBrowserUnsupportedDialog",render:function(){return (g.createElement(j,{shown:true,width:440},g.createElement(m,{showCloseButton:false},g.createElement("span",null,"Can't connect Call")),g.createElement(k,null,this._dialogBody()),g.createElement(l,{leftContent:this._footerContent()})));},_dialogBody:function(){var p=this.props.peerName;return (g.createElement("p",null,h._("{name} isn't using a browser that supports video calling yet.",[h.param("name",p)])));},_footerContent:function(){return (g.createElement("span",null,h._("Still need help? See our {troubleShootingGuideLink}",[h.param("troubleShootingGuideLink",g.createElement(i,{href:n.unsupportedBrowserUrl(),target:"_blank"},"Troubleshooting Guide"))])));}});e.exports=o;},null);
__d("FBRTCCallDialogController",["React","ReactLayeredComponentMixin","FBRTCSettingsDialog.react","FBRTCStruct","FBRTCMediaAccessErrorDialog.react","FBRTCPeerBrowserUnsupportedDialog.react"],function(a,b,c,d,e,f,g,h,i,j,k,l){var m=new j(['ERROR_ACCESSING_MEDIA','PEER_BROWSER_UNSUPPORTED','SETTINGS']),n=g.createClass({displayName:"DialogOwner",mixins:[h],renderLayers:function(){if(this.props.dialogType===m.ERROR_ACCESSING_MEDIA)return {dialog:g.createElement(k,null)};if(this.props.dialogType===m.PEER_BROWSER_UNSUPPORTED){var p=this.props.callModel.peerName();return {dialog:g.createElement(l,{peerName:p})};}if(this.props.dialogType===m.SETTINGS)return {dialog:g.createElement(i,null)};return {};},render:function(){return g.createElement("div",null);}}),o={dialogTypes:m,setDialogContainer:function(p){this.container=p;this.currentDialogType=null;this.callModel=null;this._render();},showDialog:function(p,q){this.currentDialogType=p;this.callModel=q;this._render();},hideDialog:function(){this.currentDialogType=null;this._render();},_render:function(){g.render(g.createElement(n,{dialogType:this.currentDialogType,callModel:this.callModel}),this.container);}};e.exports=o;},null);
__d("FBRTCRingback",["ChatConfig","Sound","FBRTCCallModel"],function(a,b,c,d,e,f,g,h,i){var j=[g.get('sound.ringback_mp3_url'),g.get('sound.ringback_ogg_url')],k={monitorCallModel:function(l){if(this._subscription)this._subscription.remove();this._callModel=l;this._subscription=l.addListener('changed',this._onChange.bind(this));},_soundIsPlaying:false,_onChange:function(){if(this._callModel.uiState===i.UIState.RINGING){this._startSound();}else this._stopSound();},_startSound:function(){if(!this._soundIsPlaying){h.play(j,this._syncToken(),true);this._soundIsPlaying=true;}},_syncToken:function(){return 'ring_back_'+this._callModel.callID.toString();},_stopSound:function(){if(this._soundIsPlaying){h.stop(j);this._soundIsPlaying=false;}}};e.exports=k;},null);
__d("FBRTCVideo.react",["React","cx"],function(a,b,c,d,e,f,g,h){var i=g.createClass({displayName:"FBRTCVideo",hideContextMenu:function(j){j.preventDefault();},componentDidMount:function(){this._attachStream();},shouldComponentUpdate:function(j,k){return this._streamDidChange();},componentDidUpdate:function(j,k){this._attachStream();},_attachStream:function(){if(this.props.stream){var j=this.getDOMNode();this.props.stream.attachToVideoTag(j);this._currentStream=this.props.stream.getStream();}},_streamDidChange:function(){var j=this.props.stream?this.props.stream.getStream():null;return j!==this._currentStream;},render:function(){return (g.createElement("video",{className:"_3vsh",autoPlay:'true',muted:this.props.muted,onContextMenu:this.hideContextMenu}));}});e.exports=i;},null);
__d("FBRTCVideoMuteOverlay.react",["React","cx","Image.react"],function(a,b,c,d,e,f,g,h,i){var j=g.createClass({displayName:"FBRTCVideoMuteOverlay",_className:function(k){var l=!k.localStream.hasVideo();return (("_3nx7")+(l?' '+"_3nx8":''));},render:function(){var k=this.props.callModel;return (g.createElement("div",{className:this._className(k)},g.createElement(i,{src:k.selfPicUrl(),alt:"video muted"})));}});e.exports=j;},null);
__d("FBRTCSelfView.react",["cx","React","FBRTCConstants","FBRTCVideo.react","FBRTCStreamWrapper","FBRTCVideoMuteOverlay.react"],function(a,b,c,d,e,f,g,h,i,j,k,l){var m=h.createClass({displayName:"FBRTCSelfView",toggleSelfView:function(n){this.props.publishFn(i.UIEventType.TOGGLE_SELF_VIEW);},toggleIconClass:function(n,o){return (("_2y66")+(n?' '+"_2y67":'')+(!n?' '+"_2y68":'')+(!o?' '+"_hgl":''));},outerClasses:function(n){var o=(n.localStream.aspectRatio===k.aspectRatios['16:9']);return (("_1qmr")+(o?' '+"_yse":''));},wrapperClasses:function(n){return (("_1qmn")+(!n.selfViewOpen?' '+"_1qmo":''));},overlayClasses:function(n){var o=n.localStream.hasAudio();return (("_1qmp")+(o?' '+"_1qmq":''));},render:function(){var n=this.props.callModel,o=n.selfViewOpen;return (h.createElement("div",{className:this.outerClasses(n)},h.createElement("button",{onClick:this.toggleSelfView,className:"_1qms"},h.createElement("i",{className:this.toggleIconClass(true,!o)}),h.createElement("i",{className:this.toggleIconClass(false,o)})),h.createElement("div",{className:this.wrapperClasses(n)},h.createElement(l,{callModel:n}),h.createElement("div",{className:this.overlayClasses(n)},h.createElement("i",{className:"_2y69"})),h.createElement(j,{muted:true,stream:n.localStream}))));}});e.exports=m;},null);
__d("FBRTCInCallView.react",["React","cx","FBRTCSelfView.react","FBRTCVideo.react","FBRTCCallModel"],function(a,b,c,d,e,f,g,h,i,j,k){var l=g.createClass({displayName:"FBRTCInCallView",_videoIsMuted:function(){var m=this.props.callModel.remoteStream;return m&&!m.hasVideo();},_containerClasses:function(m){var n=m===k.UIState.CALL_CONNECTED,o=m===k.UIState.CALL_ENDED;return (("_mdl")+(n||o?' '+"_mdm":'')+(n?' '+"_mdn":'')+(o?' '+"_2m5f":''));},_wrapperClasses:function(){var m=this._videoIsMuted();return (("_2tvg")+(m?' '+"_mdo":''));},render:function(){var m=this.props.callModel,n=this.props.publishFn;if(m.remoteStream.hasStream()){var o=m.uiState;return (g.createElement("div",{className:this._containerClasses(o)},g.createElement("div",{className:this._wrapperClasses()},g.createElement("div",{className:"_mdt"},g.createElement(j,{stream:m.remoteStream}))),g.createElement(i,{callModel:m,publishFn:n})));}else return g.createElement("div",{className:"_hgl"});}});e.exports=l;},null);
__d("FBRTCCallTimer.react",["React","cx"],function(a,b,c,d,e,f,g,h){var i=g.createClass({displayName:"FBRTCCallTimer",getInitialState:function(){return {secondsElapsed:0};},tick:function(){this.setState({secondsElapsed:this.state.secondsElapsed+1});},componentDidMount:function(){this.interval=setInterval(this.tick,1000);},componentWillUnmount:function(){clearInterval(this.interval);},render:function(){var j=this.state.secondsElapsed;return (g.createElement("p",{className:"_cen"},j>=3600?("0"+Math.floor(j/3600)).slice(-2)+':':'',("0"+Math.floor((j%3600)/60)).slice(-2),":",("0"+j%60).slice(-2)));}});e.exports=i;},null);
__d("FBRTCCallStateInfo.react",["React","cx","fbt","Image.react","XUISpinner.react","XUIOverlayButton.react","FBRTCCallModel","FBRTCCallTimer.react","FBRTCConstants"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){var p=function(s,t){switch(s){case o.CallEndReason.NO_ANSWER_TIMEOUT:case o.CallEndReason.IGNORE_CALL:return "No Answer";case o.CallEndReason.INCOMING_TIMEOUT:case o.CallEndReason.NO_PERMISSION:case o.CallEndReason.OTHER_NOT_CAPABLE:case o.CallEndReason.OTHER_CARRIER_BLOCKED:return "Not Reachable";case o.CallEndReason.SIGNALING_MESSAGE_FAILED:case o.CallEndReason.WEBRTC_ERROR:case o.CallEndReason.NO_UI_ERROR:case o.CallEndReason.CALLER_NOT_VISIBLE:case o.CallEndReason.CLIENT_ERROR:return "Call Failed";case o.CallEndReason.UNSUPPORTED_VERSION:return "Can't connect Call";case o.CallEndReason.IN_ANOTHER_CALL:return "On Another Call";case o.CallEndReason.CARRIER_BLOCKED:return "Switch to Wi-Fi to complete your call";case o.CallEndReason.CLIENT_INTERRUPTED:return "Call Interrupted";case o.CallEndReason.HANGUP_CALL:case o.CallEndReason.ACCEPT_AFTER_HANGUP:return "Call Ended";case o.CallEndReason.CONNECTION_DROPPED:return "Connection Lost";case o.CallEndReason.OTHER_INSTANCE_HANDLED:return '';default:return '';}},q=function(s){switch(s.uiState){case m.UIState.INIT:case m.UIState.PENDING_LOCAL_MEDIA:case m.UIState.MORE_INIT:case m.UIState.USER_MEDIA_DENIED:return (g.createElement(k,{background:"dark",size:"large"}));case m.UIState.CONTACTING:return "Contacting...";case m.UIState.RINGING:return "Ringing...";case m.UIState.CALL_CONNECTING:return "Connecting...";case m.UIState.CALL_CONNECTED:return s.peerName();case m.UIState.CALL_ENDED:return p(s.endCallReason,s.isRemoteEnded);default:return '';}},r=g.createClass({displayName:"FBRTCCallStateInfo",revealContainer:function(){var s="_4j_h",t=document.getElementsByClassName(s)[0];if(t)t.className=s;},onCloseButtonClicked:function(s){window.close();return;},componentDidMount:function(){setTimeout(function(){this.revealContainer();}.bind(this),2000);},render:function(){var s=this.props.callModel,t=q(s);return (g.createElement("div",{className:"_4j_i"},this.renderPeerImage(s),g.createElement("p",{className:"_4j_k"},t),this.renderCallStateTimer(s),this.renderCloseWindowButton()));},renderCallStateTimer:function(s){if(s.uiState===m.UIState.CALL_CONNECTED)return g.createElement(n,null);},renderPeerImage:function(s){if(s.peerPicUrl())return (g.createElement(j,{className:"_4j_j",src:s.peerPicUrl(),alt:"profile pic",onLoad:this.revealContainer,onError:this.revealContainer}));return '';},shouldRenderCloseButton:function(){var s=this.props.callModel;return s.uiState===m.UIState.CALL_ENDED&&(!s.wasConnected||s.endCallReason!==o.CallEndReason.HANGUP_CALL);},renderCloseWindowButton:function(){if(this.shouldRenderCloseButton()){return (g.createElement(l,{className:"_1-7l",label:"Close Window",onClick:this.onCloseButtonClicked}));}else return '';}});e.exports=r;},null);
__d("FBRTCCallControls.react",["cx","fbt","React","ReactLayeredComponentMixin","XUIContextualDialog.react","XUIContextualDialogBody.react","XUIContextualDialogTitle.react","LayerFadeOnHide","LayerFadeOnShow","FBRTCCallModel","FBRTCConfig","FBRTCConstants","FBRTCStruct"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){var t=10000,u=new s(['READY','SHOWN','COMPLETE']),v=function(y,z,aa,ba){var ca=(!z||y===p.UIState.CALL_ENDED);return (("_hgk")+(ba?' '+"_urf":'')+(ca?' '+"_hgl":'')+(aa===u.SHOWN?' '+"_2727":''));},w=function(y,z,aa,ba){return ((y?"_hgm":'')+(' '+"_hgn")+(z?' '+"_hgp":'')+(aa?' '+"_hgq":'')+(ba?' '+"_hgr":''));},x=i.createClass({displayName:"FBRTCCallControls",mixins:[j],getInitialState:function(){return {forceVisible:u.READY};},_shouldForceVisible:function(y){var z=y.localStream;return y.videoIsAutoDisabled()||(z.hasStream()&&!z.hasVideoTracks());},componentWillReceiveProps:function(y){if(this._shouldForceVisible(y.callModel)){if(this.state.forceVisible===u.READY){this.setState({forceVisible:u.SHOWN});setTimeout(function(){this.setState({forceVisible:u.COMPLETE});}.bind(this),t);}}else if(this.state.forceVisible===u.SHOWN)this.setState({forceVisible:u.COMPLETE});},_popoverProps:function(){var y={contextRef:'videoButton',position:'above',alignment:'left',width:255,hoverContext:this.refs.videoButton.getDOMNode(),behaviors:{LayerFadeOnHide:n,LayerFadeOnShow:o}};if(this.state.forceVisible===u.SHOWN)y.shown=true;return y;},renderLayers:function(){var y,z={};if(!this.props.callModel.localStream.hasVideoTracks()){y=(i.createElement(k,i.__spread({},this._popoverProps()),i.createElement(m,null,"Can't Find Camera"),i.createElement(l,null,"Connect your camera and refresh the page to turn on video.")));}else if(this.props.callModel.videoIsAutoDisabled())y=(i.createElement(k,i.__spread({},this._popoverProps()),i.createElement(l,null,"Video is paused because the connection is slow.")));if(y)z.videoPopover=y;return z;},toggleMuteAudio:function(y){this.props.publishFn(r.UIEventType.TOGGLE_MUTE_AUDIO,y);},toggleMuteVideo:function(y){this.props.publishFn(r.UIEventType.TOGGLE_MUTE_VIDEO,y);},toggleFullScreen:function(y){this.props.publishFn(r.UIEventType.TOGGLE_FULL_SCREEN,y);},endCall:function(y){this.props.publishFn(r.UIEventType.HANG_UP,y);},showSettings:function(y){if(q.settingsEnabled())this.props.publishFn(r.UIEventType.SHOW_SETTINGS,y);},render:function(){var y=q.settingsEnabled(),z=this.props.callModel.uiState,aa=this.props.callModel.localStream.hasStream(),ba=!this.props.callModel.localStream.hasVideo(),ca=!this.props.callModel.localStream.hasAudio(),da=this.props.callModel.isFullScreen(),ea=w(ba,true,false,false),fa=w(ca,false,false,false),ga=w(false,false,false,true),ha=w(false,false,true,false),ia=v(z,aa,this.state.forceVisible,y);return (i.createElement("div",{className:ia},i.createElement("button",{onClick:this.toggleMuteVideo,className:ea,ref:"videoButton"},i.createElement("i",{className:(("_qor")+(!ba?' '+"_qos":'')+(ba?' '+"_qot":''))})),i.createElement("button",{onClick:this.toggleMuteAudio,className:fa},i.createElement("i",{className:(("_qor")+(!ca?' '+"_qou":'')+(ca?' '+"_qov":''))})),i.createElement("button",{onClick:this.endCall,className:ga},i.createElement("i",{className:"_qor _hgs"}),i.createElement("i",{className:"_qor _hgt"})),this._settingsButton(y),i.createElement("button",{onClick:this.toggleFullScreen,className:ha},i.createElement("i",{className:(("_qor")+(!da?' '+"_qow":'')+(da?' '+"_qox":''))}))));},_settingsButton:function(y){if(y){var z=w(false,false,false,false);return (i.createElement("button",{onClick:this.showSettings,className:z},i.createElement("i",{className:"_qor _urg"})));}}});e.exports=x;},null);
__d("FBRTCFadeInMixin",["cx","joinClasses"],function(a,b,c,d,e,f,g,h){var i={componentDidMount:function(){var j=this.getDOMNode();j.style.opacity=0;j.className=h(j.className,"_2hy");setTimeout(function(){j.style.opacity=1;},1);}};e.exports=i;},null);
__d("FBRTCFeedbackCompleteView.react",["cx","fbt","React","XUIOverlayButton.react","FBRTCFadeInMixin"],function(a,b,c,d,e,f,g,h,i,j,k){var l=i.createClass({displayName:"FBRTCFeedbackCompleteView",mixins:[k],onCallBackButtonClicked:function(){return;},onCloseButtonClicked:function(){window.close();return;},messageString:function(){if(this.props.skipped)return "Your call has ended";return "Thank you for your feedback!";},render:function(){return (i.createElement("div",{className:"_1-7k"},i.createElement("p",{className:"_4j_k"},this.messageString()),i.createElement("div",null,i.createElement(j,{className:"_1-7l",label:"Close Window",onClick:this.onCloseButtonClicked}))));}});e.exports=l;},null);
__d("FBRTCFeedbackView.react",["cx","fbt","React","XUIOverlayButton.react","FBRTCConstants","FBRTCFadeInMixin","FBRTCFeedbackCompleteView.react"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){var n=i.createClass({displayName:"FBRTCFeedbackView",mixins:[l],getInitialState:function(){return {submitted:false,skipped:false,feedbackText:''};},onSubmitButtonClicked:function(){if(this.canSubmitFeedback()){this.setState({submitted:true});this.props.publishFn(k.UIEventType.SUBMIT_FEEDBACK,this.state.feedbackText);}},onNotNowClicked:function(){this.setState({skipped:true,submitted:true});return;},canSubmitFeedback:function(){return this.state.feedbackText!=='';},feedbackChanged:function(o){this.setState({feedbackText:o.target.value});o.preventDefault();},render:function(){if(this.state.submitted)return i.createElement(m,{skipped:this.state.skipped});return (i.createElement("div",{className:"_1-7k"},i.createElement("p",{className:"_4j_k"},"Give Feedback"),i.createElement("div",{className:"_4ru1"},i.createElement("label",{htmlFor:"fbwebrtcfeedback",className:"_4j_k _4ru2"},"What was the worst problem you experienced?"),i.createElement("textarea",{className:"_4ru3",id:"fbwebrtcfeedback",rows:"4",onChange:this.feedbackChanged,placeholder:"Enter your feedback"}),i.createElement("div",{className:"_s97"},i.createElement(j,{className:"_1-7l",label:"Submit",disabled:!this.canSubmitFeedback(),onClick:this.onSubmitButtonClicked}),i.createElement(j,{className:"_1-7l",label:"Not Now",onClick:this.onNotNowClicked})))));}});e.exports=n;},null);
__d("FBRTCStarRatingView.react",["cx","fbt","FBRTCConstants","FBRTCFadeInMixin","React","StarsInput.react","XUIOverlayButton.react","FBRTCFeedbackCompleteView.react","FBRTCFeedbackView.react"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){var p=k.createClass({displayName:"FBRTCStarRatingView",mixins:[j],getInitialState:function(){return {rating:0,submitted:false,skipped:false,feedbackText:''};},onCallBackButtonClicked:function(){return;},onCloseButtonClicked:function(){window.close();return;},onStarClicked:function(q){this.setState({rating:q});},onSubmitButtonClicked:function(){if(this.state.rating>0){this.setState({submitted:true});this.props.publishFn(i.UIEventType.SUBMIT_STAR_RATING,this.state.rating);}},onNotNowClicked:function(){this.setState({skipped:true,submitted:true});return;},getRatingString:function(){switch(this.state.rating){case 1:return "Poor";case 2:return "Fair";case 3:return "Good";case 4:return "Very good";case 5:return "Excellent";default:return '---';}},shouldAskForFeedback:function(){return this.state.rating===1&&this.state.submitted&&!this.state.skipped;},render:function(){if(this.shouldAskForFeedback()){return k.createElement(o,{publishFn:this.props.publishFn});}else if(this.state.submitted)return k.createElement(n,{skipped:this.state.skipped});var q=this.getRatingString();return (k.createElement("div",{className:"_1-7k"},k.createElement("p",{className:"_4j_k"},"Please rate the quality of your video call"),k.createElement("p",{className:"_4j_k _a16"},q),k.createElement(l,{allowMultipleSubmissions:true,onClick:this.onStarClicked}),k.createElement("div",{className:"_s97"},k.createElement(m,{className:"_1-7l",label:"Not Now",onClick:this.onNotNowClicked}),k.createElement(m,{className:"_1-7l",label:"Submit",disabled:this.state.rating===0,onClick:this.onSubmitButtonClicked}))));}});e.exports=p;},null);
__d("FBRTCMediaAccessPrompt.react",["React","cx","fbt","UserAgent","Link.react","XUIText.react","FBRTCCallModel","FBRTCConfig"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){var o=g.createClass({displayName:"FBRTCMediaAccessPrompt",isVisible:function(p){return (j.isBrowser('Chrome')||j.isBrowser('Firefox'))&&p===m.UIState.PENDING_LOCAL_MEDIA;},componentWillUpdate:function(p,q){var r=p.callModel.uiState;if(this.isVisible(r)){clearTimeout(this.timeout);this.getDOMNode().style.display='block';}},componentDidUpdate:function(p,q){var r=this.props.callModel.uiState;if(!this.isVisible(r))this.timeout=setTimeout(function(){this.getDOMNode().style.display='none';}.bind(this),500);},componentWillUnmount:function(){clearTimeout(this.timeout);},dialogTitle:function(){if(j.isBrowser('Chrome')){return "Click \"Allow\" to Make a Call";}else return "Click the camera and choose \"Share Selected Devices\"";},dialogBody:function(){return "To make a video call on Facebook, you need to turn on your camera and microphone. This will let your friend see and hear you during the call. You can always turn these off later.";},learnMoreLink:function(){return (g.createElement(k,{href:n.userMediaPermissionErrorUrl(),target:"_blank"},"Learn more"));},render:function(){var p=this.props.callModel.uiState;return (g.createElement("div",{className:(("_250-")+(!this.isVisible(p)?' '+"_250_":''))},g.createElement("i",{className:"_2510"}),g.createElement("i",{className:"_2511"}),g.createElement("div",{className:"_2514"},g.createElement("h1",{className:"_2515"},this.dialogTitle()),g.createElement(l,{size:"small",display:"block"},this.dialogBody()," ",this.learnMoreLink()))));}});e.exports=o;},null);
__d("FBRTCMediaDeniedPrompt.react",["React","cx","fbt","UserAgent","XUIContextualDialog.react","XUIContextualDialogBody.react","XUIContextualDialogTitle.react","ReactLayeredComponentMixin","FBRTCCallModel"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){var p=g.createClass({displayName:"FBRTCMediaDeniedPrompt",mixins:[n],showDialog:function(){var q=this.props.callModel;return q.uiState===o.UIState.USER_MEDIA_DENIED;},arrowAlignment:function(){return j.isBrowser('Chrome')?'right':'left';},dialogTitle:function(){return "Click to Turn on Camera\/Microphone";},dialogBody:function(){return "To use video calling, you need to turn on your camera and microphone during the call.";},renderLayers:function(){return {popover:(g.createElement(k,{contextRef:"mpTarget",shown:this.showDialog(),position:"below",alignment:this.arrowAlignment(),width:k.WIDTH.NORMAL},g.createElement(m,null,this.dialogTitle()),g.createElement(l,null,this.dialogBody())))};},render:function(){return (g.createElement("div",{className:"_3wrz",ref:"mpTarget"}));}});e.exports=p;},null);
__d("FBRTCBackgroundView.react",["React","Image.react","cx"],function(a,b,c,d,e,f,g,h,i){var j=g.createClass({displayName:"FBRTCBackgroundView",getInitialState:function(){return {showCoverPhoto:true};},imageError:function(){this.setState({showCoverPhoto:false});},render:function(){var k=this.props.callModel.backgroundUrl();if(this.state.showCoverPhoto&&k){return (g.createElement("div",{className:"_6qv"},g.createElement("div",{className:"_6qw"}),g.createElement(h,{src:k,className:"_6q_",alt:"",onError:this.imageError})));}else return g.createElement("div",{className:"_6qv"});}});e.exports=j;},null);
__d("FBRTCView.react",["React","cx","ix","Image.react","FBRTCInCallView.react","FBRTCCallStateInfo.react","FBRTCCallControls.react","FBRTCStarRatingView.react","FBRTCStreamWrapper","FBRTCMediaAccessPrompt.react","FBRTCMediaDeniedPrompt.react","FBRTCCallModel","FBRTCBackgroundView.react"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){var t=g.createClass({displayName:"FBRTCView",_aspectRatioClass:function(u){var v=u.remoteStream.aspectRatio===o.aspectRatios['16:9'];return (("_mdp")+(!v?' '+"_mdq":'')+(v?' '+"_mds":''));},render:function(){var u=this.props.callModel,v=this.props.publishFn;if(u.uiState===r.UIState.COLLECT_RATING){return (g.createElement("div",{className:"_3ref"},g.createElement("div",{className:this._aspectRatioClass(u)},g.createElement(s,{callModel:u}),g.createElement(j,{src:i('/images/chat/webrtc/facebook_logo.png'),className:"_263g",alt:"Facebook"}),g.createElement(n,{publishFn:v}))));}else return (g.createElement("div",{className:"_3ref"},g.createElement(p,{callModel:u}),g.createElement(q,{callModel:u}),g.createElement(l,{callModel:u}),g.createElement("div",{className:this._aspectRatioClass(u)},g.createElement(s,{callModel:u}),g.createElement(j,{src:i('/images/chat/webrtc/facebook_logo.png'),className:"_263g",alt:"Facebook"}),g.createElement(k,{callModel:u,publishFn:v}),g.createElement(m,{callModel:u,publishFn:v}))));}});e.exports=t;},null);
__d("FBRTCViewController",["React","FBRTCCallModel","FBRTCConstants","FBRTCCallDialogController","FBRTCFullScreenController","FBRTCLogger","FBRTCRingback","FBRTCView.react"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){var o=500;function p(q,r,s){"use strict";this.$FBRTCViewController0=q;this.$FBRTCViewController1=r;this.$FBRTCViewController2=s;this.$FBRTCViewController3=false;this.$FBRTCViewController4=l.getInstance();}p.prototype.init=function(){"use strict";var q=this;this.$FBRTCViewController0.addListener('changed',function(t){if(t===h.UIState.COLLECT_RATING)q.$FBRTCViewController5();q.$FBRTCViewController6();});m.monitorCallModel(this.$FBRTCViewController0);var r=this.$FBRTCViewController6.bind(this);k.onFullScreenChange(r);this.$FBRTCViewController0.fetchPeerInfo();this.$FBRTCViewController6();var s=this.$FBRTCViewController0;setTimeout(function(){s.setStateFrom(h.UIState.INIT,h.UIState.PENDING_LOCAL_MEDIA);},o);};p.prototype.onLocalStreamReady=function(q){"use strict";this.$FBRTCViewController0.setLocalStream(q);if(this.$FBRTCViewController0.uiState>h.UIState.MORE_INIT){this.$FBRTCViewController4.logInfo(this.$FBRTCViewController0.peerID,this.$FBRTCViewController0.callID,'UI: Already @ MORE_INIT, no update');}else if(this.$FBRTCViewController0.canStartCall()&&!this.$FBRTCViewController0.isCaller){this.$FBRTCViewController0.setState(h.UIState.CALL_CONNECTING);}else this.$FBRTCViewController0.setState(h.UIState.MORE_INIT);};p.prototype.userMediaGranted=function(){"use strict";this.$FBRTCViewController0.setState(h.UIState.MORE_INIT);};p.prototype.userMediaDenied=function(){"use strict";this.$FBRTCViewController0.setState(h.UIState.USER_MEDIA_DENIED);};p.prototype.onTurnCredentialsReady=function(q){"use strict";if(!this.$FBRTCViewController0.isCaller)this.$FBRTCViewController0.setStateFrom(h.UIState.MORE_INIT,h.UIState.CALL_CONNECTING);};p.prototype.onMessageTypeSent=function(q){"use strict";if(q!==i.PayloadType.OFFER&&q!==i.PayloadType.ICERESTART_OFFER)return;if(q===i.PayloadType.ICERESTART_OFFER)this.$FBRTCViewController3=true;this.$FBRTCViewController0.setState(h.UIState.CONTACTING);};p.prototype.onMessageTypeReceived=function(q){"use strict";if(this.$FBRTCViewController3){if(q===i.PayloadType.ANSWER)this.$FBRTCViewController0.setStateFrom(h.UIState.CONTACTING,h.UIState.CALL_CONNECTING);}else if(q===i.PayloadType.OFFER_ACK){this.$FBRTCViewController0.setStateFrom(h.UIState.CONTACTING,h.UIState.RINGING);}else if(q===i.PayloadType.ANSWER)if(this.$FBRTCViewController0.uiState===h.UIState.CONTACTING||this.$FBRTCViewController0.uiState===h.UIState.RINGING)this.$FBRTCViewController0.setState(h.UIState.CALL_CONNECTING);};p.prototype.onRemoteStreamAdded=function(event){"use strict";this.$FBRTCViewController0.setRemoteStream(event.stream);var q=this;this.$FBRTCViewController0.remoteStream.addListener('streamStarted',function(){q.$FBRTCViewController0.setStateFrom(h.UIState.CALL_CONNECTING,h.UIState.CALL_CONNECTED);});this.$FBRTCViewController0.remoteStream.addListener('tracksChanged',function(){q.$FBRTCViewController6();});this.$FBRTCViewController6();};p.prototype.end=function(q,r){"use strict";this.$FBRTCViewController0.endCallReason=q;this.$FBRTCViewController0.isRemoteEnded=r;this.$FBRTCViewController0.setState(h.UIState.CALL_ENDED);};p.prototype.reset=function(q,r){"use strict";this.$FBRTCViewController0.resetForReconnect(q);this.$FBRTCViewController1=r;this.$FBRTCViewController0.setState(h.UIState.CALL_CONNECTING);};p.prototype.$FBRTCViewController7=function(q,r){"use strict";switch(q){case i.UIEventType.HANG_UP:this.$FBRTCViewController8(r);break;case i.UIEventType.TOGGLE_MUTE_AUDIO:this.$FBRTCViewController9(r);break;case i.UIEventType.TOGGLE_MUTE_VIDEO:this.$FBRTCViewControllera(r);break;case i.UIEventType.TOGGLE_FULL_SCREEN:this.$FBRTCViewControllerb(r);break;case i.UIEventType.TOGGLE_SELF_VIEW:this.$FBRTCViewControllerc(r);break;case i.UIEventType.SUBMIT_STAR_RATING:this.$FBRTCViewControllerd(r);break;case i.UIEventType.SUBMIT_FEEDBACK:this.$FBRTCViewControllere(r);break;case i.UIEventType.SHOW_SETTINGS:this.$FBRTCViewControllerf(r);break;default:break;}};p.prototype.$FBRTCViewControllerf=function(q){"use strict";j.showDialog(j.dialogTypes.SETTINGS,this.$FBRTCViewController0);};p.prototype.$FBRTCViewController8=function(q){"use strict";if(this.onHangup)this.onHangup();};p.prototype.$FBRTCViewController9=function(q){"use strict";this.$FBRTCViewController0.localStream.toggleMuteAudio();this.$FBRTCViewController6();this.$FBRTCViewControllerg(l.CallAction.SET_MUTE,!this.$FBRTCViewController0.localStream.hasAudio());};p.prototype.$FBRTCViewControllera=function(q){"use strict";this.$FBRTCViewController0.localStream.toggleMuteVideo();this.$FBRTCViewControllerg(l.CallAction.SET_VIDEO_ON,this.$FBRTCViewController0.localStream.hasVideo());};p.prototype.$FBRTCViewControllerb=function(q){"use strict";k.toggleFullScreen();this.$FBRTCViewControllerg(l.CallAction.SET_FULLSCREEN_ON,k.isFullScreen());};p.prototype.$FBRTCViewControllerc=function(q){"use strict";this.$FBRTCViewController0.selfViewOpen=!this.$FBRTCViewController0.selfViewOpen;this.$FBRTCViewController6();this.$FBRTCViewControllerg(l.CallAction.SET_SELF_VIEW_ON,this.$FBRTCViewController0.selfViewOpen);};p.prototype.$FBRTCViewController5=function(){"use strict";this.$FBRTCViewController1.addExtraInfo(l.Key.RATING_SHOWN,'1');this.$FBRTCViewController1.save(this.$FBRTCViewController2);};p.prototype.$FBRTCViewControllerd=function(q){"use strict";if(q<1||q>5){this.$FBRTCViewControllerh(this.$FBRTCViewController0.peerID,this.$FBRTCViewController0.callID,'Bad rating: '+q);return;}this.$FBRTCViewController1.addExtraInfo(l.Key.RATING,q);this.$FBRTCViewController1.save(this.$FBRTCViewController2);};p.prototype.$FBRTCViewControllere=function(q){"use strict";this.$FBRTCViewController1.addExtraInfo(l.Key.SURVEY_DETAILS,q);this.$FBRTCViewController1.save(this.$FBRTCViewController2);};p.prototype.$FBRTCViewControllerg=function(q,r){"use strict";this.$FBRTCViewController4.logCallAction(this.$FBRTCViewController0.peerID,this.$FBRTCViewController0.callID,q,r?'true':'false');};p.prototype.$FBRTCViewController6=function(){"use strict";if(this.$FBRTCViewController0.invalidated)return;var q=document.getElementById('fbRTC/container');g.render(g.createElement(n,{callModel:this.$FBRTCViewController0,publishFn:this.$FBRTCViewController7.bind(this)}),q);};e.exports=p;},null);
__d("FBRTCCallModelStatePusher",["FBRTCCallModel","FBRTCConstants"],function(a,b,c,d,e,f,g,h){function i(j){"use strict";this.$FBRTCCallModelStatePusher0=j;this.$FBRTCCallModelStatePusher0.addListener('changed',this.$FBRTCCallModelStatePusher1.bind(this));}i.prototype.$FBRTCCallModelStatePusher2=function(){"use strict";return this.$FBRTCCallModelStatePusher0.uiState===g.UIState.CALL_ENDED&&this.$FBRTCCallModelStatePusher0.wasConnected&&this.$FBRTCCallModelStatePusher0.endCallReason===h.CallEndReason.HANGUP_CALL;};i.prototype.$FBRTCCallModelStatePusher1=function(){"use strict";if(this.$FBRTCCallModelStatePusher2())this.$FBRTCCallModelStatePusher3(3000,g.UIState.CALL_ENDED,g.UIState.COLLECT_RATING);};i.prototype.$FBRTCCallModelStatePusher3=function(j,k,l){"use strict";var m=this.$FBRTCCallModelStatePusher0;setTimeout(function(){m.setStateFrom(k,l);},j);};e.exports=i;},null);
__d("FBRTCRetriableMessage",["mixInEventEmitter","FBRTCConstants"],function(a,b,c,d,e,f,g,h){var i=10000,j=7000,k=1;function l(m){"use strict";this.$FBRTCRetriableMessage0=m;this.$FBRTCRetriableMessage1=i;this.$FBRTCRetriableMessage2=k;this.$FBRTCRetriableMessage3=null;this.$FBRTCRetriableMessage4=null;}l.prototype.sendMessage=function(m,n,o,p,q){"use strict";switch(m){case h.PayloadType.ICERESTART_OFFER:this.$FBRTCRetriableMessage3=this.$FBRTCRetriableMessage0.sendIcerestartOffer(n,o,p);break;case h.PayloadType.OFFER:this.$FBRTCRetriableMessage3=this.$FBRTCRetriableMessage0.sendOffer(n,o,p,q);break;case h.PayloadType.ANSWER:this.$FBRTCRetriableMessage1=j;this.$FBRTCRetriableMessage3=this.$FBRTCRetriableMessage0.sendAnswer(n,o,p,q);break;}this.$FBRTCRetriableMessage5();};l.prototype.stopRetrying=function(){"use strict";if(this.$FBRTCRetriableMessage4){clearTimeout(this.$FBRTCRetriableMessage4);this.$FBRTCRetriableMessage4=null;}};l.prototype.$FBRTCRetriableMessage5=function(){"use strict";this.$FBRTCRetriableMessage4=setTimeout(this.$FBRTCRetriableMessage6.bind(this),this.$FBRTCRetriableMessage1);};l.prototype.$FBRTCRetriableMessage6=function(){"use strict";if(this.$FBRTCRetriableMessage2<1){this.emit('timeoutFailure');}else{this.emit('sendingRetry');this.$FBRTCRetriableMessage3();this.$FBRTCRetriableMessage5();this.$FBRTCRetriableMessage2-=1;}};g(l,{sendingRetry:true,timeoutFailure:true});e.exports=l;},null);
__d("FBRTCUrlManager",["FBRTCLogger","FBRTCUtils","XVideoCallInitControllerURIBuilder","XVideoCallControllerURIBuilder","emptyFunction"],function(a,b,c,d,e,f,g,h,i,j,k){var l=0,m=function(q,r,s){g.getInstance().logCallAction(q,r,g.CallAction.OLD_URI);return new j().setInt('peer_id',q).setInt('call_id',r).setBool('is_caller',s).getURI();},n=function(q,r,s,t,u,v){if(v===(void 0)||v===null)v=l;var w=new i().setInt('peer_id',q).setInt('call_id',r).setBool('is_caller',s).getURI();h.sendServerRequest(w,function(x){t(x.payload.uri);},function(x){if(v>0){n(q,r,s,t,u,v-1);}else t(m(q,r,s));},false,1000);},o=function(q){window.history.replaceState({},'',q);},p={init:function(q,r){this._pendingUriUpdate=false;this._peerID=q.peerID;this._callID=q.callID;if(r){this._connectedUri=r;}else this._connectedUri=m(this._peerID,this._callID);},setCallModel:function(q){if(this._peerID!==q.peerID||this._callID!==q.callID){this._peerID=q.peerID;this._callID=q.callID;this._connectedUri=null;n(this._peerID,this._callID,null,this._onNewConnectedUriSet.bind(this),k);}},onCallStarted:function(){if(this._connectedUri){o(this._connectedUri);}else this._pendingUriUpdate=true;},onCallEnded:function(){o(m(this._peerID));},getCallUri:n,_onNewConnectedUriSet:function(q){this._connectedUri=q;if(this._pendingUriUpdate){o(q);this._pendingUriUpdate=false;}}};e.exports=p;},null);
__d("FBRTCWindowManager",[],function(a,b,c,d,e,f){var g={init:function(h,i){this._window=h;this._callModel=i;i.addListener('changed',this._setProgressIndicator,this);this._setProgressIndicator();this._monitorOpenerForChanges();},_setProgressIndicator:function(){if(this._callModel.isEnded()){this._window.rtcCallInProgessWith=null;}else this._window.rtcCallInProgessWith=this._callModel.peerID.toString();},_monitorOpenerForChanges:function(){if(this._window.opener)this._window.opener.addEventListener("unload",function(event){this._passWindowToOpener(10);}.bind(this));},_passWindowToOpener:function(h){setTimeout(function(){setTimeout(function(){if(this._window.opener&&!this._window.opener.closed)this._window.opener.rtcCallChildWindow=this._window;}.bind(this),1);if(h>1)this._passWindowToOpener(h-1);}.bind(this),1000);}};e.exports=g;},null);
__d("FBRTCCallController",["AsyncRequest","ErrorUtils","MercuryConstants","MissedVideoCallHandler","Run","VideoCallCore","VideoCallSupport","FBRTCCallConnection","FBRTCCallConnectionMonitor","FBRTCCallModel","FBRTCCallMonitor","FBRTCCallSummary","FBRTCCallSummaryStore","FBRTCConfig","FBRTCConstants","FBRTCExperiments","FBRTCIceCache","FBRTCLocalMessageQueue","FBRTCLogger","FBRTCMessageDedup","FBRTCMessageUtils","FBRTCMessageSender","FBRTCPCConfig","FBRTCTurnDiscovery","FBRTCSdpUtils","FBRTCUserMedia","FBRTCViewController","FBRTCCallModelStatePusher","FBRTCCallDialogController","FBRTCRetriableMessage","FBRTCUserMediaRequest","FBRTCUrlManager","FBRTCWindowManager","emptyFunction","fbt","randomInt","AvailableList"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha,ia,ja,ka,la,ma,na,oa,pa){b('AvailableList');var qa=60000;function ra(){return pa(0,4294967295);}sa.startCall=function(ta,ua,va){"use strict";var wa=y.getInstance();wa.logInfo(ta,ua,'Starting Call Controller');document.documentElement.style.overflow='hidden';if(!m.isWebrtcSupported()){wa.logError(ta,ua,'Webrtc not supported');}else new sa(ta,ua,va);};function sa(ta,ua,va){"use strict";this.$FBRTCCallController0=y.getInstance();this.$FBRTCCallController1=new x();this.$FBRTCCallController2=s.getInstance();this.$FBRTCCallController3=null;this.$FBRTCCallController4=false;if(!va){this.$FBRTCCallController3=this.$FBRTCCallController1.getOffer(ta);if(this.$FBRTCCallController3){z.check(ta,this.$FBRTCCallController3.call_id,this.$FBRTCCallController3.msg_id);}else{va=true;this.$FBRTCCallController4=true;}}if(!ua)ua=this.$FBRTCCallController3?this.$FBRTCCallController3.call_id:ra();this.$FBRTCCallController0.logCallAction(ta,ua,y.CallAction.POPUP_OPENED);this.$FBRTCCallController5=new p({peerID:ta,callID:ua,isCaller:va});this.$FBRTCCallController6=new ha(this.$FBRTCCallController5);this.$FBRTCCallController7=r.restoreOrInitialize(this.$FBRTCCallController2,ta,ua,va,this.$FBRTCCallController3);this.$FBRTCCallController7.onPopupOpened();la.init(this.$FBRTCCallController5,t.getConnectedUri());ma.init(window,this.$FBRTCCallController5);this.$FBRTCCallController8=new ga(this.$FBRTCCallController5,this.$FBRTCCallController7,this.$FBRTCCallController2);this.$FBRTCCallController8.onHangup=this.$FBRTCCallController9.bind(this,u.CallEndReason.HANGUP_CALL,false,true,false);this.$FBRTCCallController8.init();this.$FBRTCCallControllera=new n();this.$FBRTCCallControllera.addListener('remoteStreamAdded',this.$FBRTCCallController8.onRemoteStreamAdded,this.$FBRTCCallController8);this.$FBRTCCallControllera.addListener('offerSDPCreated',this.$FBRTCCallControllerb,this);this.$FBRTCCallControllera.addListener('answerSDPCreated',this.$FBRTCCallControllerc,this);this.$FBRTCCallControllera.addListener('localIceCandidateCreated',this.$FBRTCCallControllerd,this);this.$FBRTCCallControllera.addListener('remoteDescriptionSet',this.$FBRTCCallControllere,this);this.$FBRTCCallControllera.addListener('connected',this.$FBRTCCallControllerf,this);this.$FBRTCCallControllera.addListener('disconnected',this.$FBRTCCallControllerg,this);this.$FBRTCCallControllera.addListener('connectionUnstable',this.$FBRTCCallControllerh,this);this.$FBRTCCallControllera.addListener('connectionError',this.$FBRTCCallControlleri,this);this.$FBRTCCallControllerj=new o(this.$FBRTCCallControllera,this.$FBRTCCallController7);this.$FBRTCCallControllerj.addListener('connectionPoor',this.$FBRTCCallControllerk,this);this.$FBRTCCallControllerl=new ba();this.$FBRTCCallControllerl.onMessageSent=this.$FBRTCCallControllerm.bind(this);this.$FBRTCCallControllerl.onSendFailure=this.$FBRTCCallControllern.bind(this);this.$FBRTCCallControllero=null;this.$FBRTCCallControllerp=null;this.$FBRTCCallControllerq();this.$FBRTCCallControllerr=new w();this.$FBRTCCallControllers=new w();this.$FBRTCCallControllert=false;k.onBeforeUnload(this.$FBRTCCallControlleru.bind(this),false);k.onUnload(this.$FBRTCCallControllerv.bind(this));h.addListener(this.$FBRTCCallControllerw.bind(this),true);j.setSuppressAll(true);l.setMessageHandler(na);l.setRTCMessageHandler(this.$FBRTCCallControllerx.bind(this));var wa=this;this.$FBRTCCallControllery=new q(this.$FBRTCCallController5);this.$FBRTCCallControllery.startHeartbeat(function(){return wa.$FBRTCCallController7;});this.$FBRTCCallControllerz=null;da.addListener('receivedTurnCreds',this.$FBRTCCallControllerA,this);da.addListener('failed',this.$FBRTCCallControllerB,this);da.requestTurnCreds(this.$FBRTCCallController5);}sa.prototype.$FBRTCCallControllerq=function(){"use strict";fa.addListener('streamReady',this.$FBRTCCallControllerC,this);fa.addListener('accessDenied',this.$FBRTCCallControllerD,this);fa.addListener('accessFailed',this.$FBRTCCallControllerE,this);fa.addListener('accessGranted',this.$FBRTCCallControllerF,this);var ta=t.shouldUseHdVideo(),ua=ta?fa.STREAM_TYPE.HD_VIDEO:fa.STREAM_TYPE.SD_VIDEO;fa.requestUserMedia(ua);this.$FBRTCCallController5.localStream.addListener('streamStarted',function(){var va=this.$FBRTCCallController5.localStream.videoWidth,wa=this.$FBRTCCallController5.localStream.videoHeight;this.$FBRTCCallController7.setVideoCaptureStats(va,wa);if((ta&&va===ka.HD_WIDTH)||(!ta&&va===ka.SD_WIDTH))v.logExposure(v.QE.VIDEO_QUALITY);}.bind(this));};sa.prototype.$FBRTCCallControllerh=function(){"use strict";this.$FBRTCCallController0.logInfo(this.$FBRTCCallController5.peerID,this.$FBRTCCallController5.callID,'Network unstable');};sa.prototype.$FBRTCCallControllerk=function(){"use strict";this.$FBRTCCallController0.logInfo(this.$FBRTCCallController5.peerID,this.$FBRTCCallController5.callID,'Network poor');v.logExposure(v.QE.AUTO_DISABLE);if(t.shouldAutoDisableVideo())this.$FBRTCCallController5.autoDisableVideo();};sa.prototype.$FBRTCCallControllerw=function(ta){"use strict";var ua=ta.message+'; '+ta.stackFrames[0].identifier;this.$FBRTCCallController0.logError(this.$FBRTCCallController5.peerID,this.$FBRTCCallController5.callID,'JSError: '+ua);};sa.prototype.$FBRTCCallControlleru=function(){"use strict";if(this.$FBRTCCallController5.isInProgress())return "Leaving this page will end your call.";};sa.prototype.$FBRTCCallControllerv=function(){"use strict";if(this.$FBRTCCallController5.isInProgress())if(this.$FBRTCCallControllerz){this.$FBRTCCallController9(u.CallEndReason.HANGUP_CALL,false,true,true);return;}if(!this.$FBRTCCallController5.isEnded()){var ta=this.$FBRTCCallController5.isUserMediaPending(),ua=this.$FBRTCCallController5.isUserMediaDenied(),va=u.CallEndReason.HANGUP_CALL,wa='BrowserClosed';if(ta||ua){va=u.CallEndReason.CLIENT_ERROR;wa=ta?'MediaPending':'MediaDenied';}this.$FBRTCCallController7.onCallEnded(va,false,true,wa);this.$FBRTCCallController7.save(this.$FBRTCCallController2);}};sa.prototype.$FBRTCCallControllerA=function(ta){"use strict";this.$FBRTCCallController0.logInfo(this.$FBRTCCallController5.peerID,this.$FBRTCCallController5.callID,'Received Turn Creds');ca.setTurnCredentials(ta);this.$FBRTCCallController8.onTurnCredentialsReady(ta);this.$FBRTCCallControllerG();};sa.prototype.$FBRTCCallControllerB=function(){"use strict";this.$FBRTCCallController0.logError(this.$FBRTCCallController5.peerID,this.$FBRTCCallController5.callID,'Failed to get turn creds');this.$FBRTCCallController9(u.CallEndReason.CLIENT_ERROR,false,!this.$FBRTCCallController5.isCaller,false,'NoTurnCreds');};sa.prototype.$FBRTCCallControllerG=function(){"use strict";if(this.$FBRTCCallController5.canStartCall()){la.onCallStarted();this.$FBRTCCallControllera.init(this.$FBRTCCallController5.localStream);if(!this.$FBRTCCallController3){this.$FBRTCCallControllera.createOffer();}else{if(this.$FBRTCCallController3.hasOwnProperty('videoon'))this.$FBRTCCallControllerH(this.$FBRTCCallController3.videoon);this.$FBRTCCallControllerI(this.$FBRTCCallController3.sdp,true);this.$FBRTCCallController1.removeOffer(this.$FBRTCCallController5.peerID);this.$FBRTCCallController3=null;}this.$FBRTCCallController1.enableDequeuing(this.$FBRTCCallController5.peerID,this.$FBRTCCallControllerx.bind(this));}};sa.prototype.$FBRTCCallControllerC=function(ta){"use strict";this.$FBRTCCallController8.onLocalStreamReady(ta);this.$FBRTCCallController5.localStream.addListener('tracksChanged',this.$FBRTCCallControllerJ.bind(this));this.$FBRTCCallControllerG();};sa.prototype.$FBRTCCallControllerD=function(){"use strict";this.$FBRTCCallController0.logCallAction(this.$FBRTCCallController5.peerID,this.$FBRTCCallController5.callID,y.CallAction.DENIED_PERMISSION);this.$FBRTCCallController8.userMediaDenied();};sa.prototype.$FBRTCCallControllerE=function(ta){"use strict";this.$FBRTCCallController9(u.CallEndReason.CLIENT_ERROR,false,true,false,ta);ia.showDialog(ia.dialogTypes.ERROR_ACCESSING_MEDIA,this.$FBRTCCallController5);};sa.prototype.$FBRTCCallControllerF=function(){"use strict";this.$FBRTCCallController8.userMediaGranted();};sa.prototype.$FBRTCCallControllerb=function(ta){"use strict";var ua;if(!this.$FBRTCCallController4){ua=u.PayloadType.OFFER;}else{ua=u.PayloadType.ICERESTART_OFFER;this.$FBRTCCallController4=false;}this.$FBRTCCallControllero=new ja(this.$FBRTCCallControllerl);this.$FBRTCCallControllero.addListener('sendingRetry',this.$FBRTCCallControllerK.bind(this));this.$FBRTCCallControllero.addListener('timeoutFailure',this.$FBRTCCallControllerL.bind(this));this.$FBRTCCallControllero.sendMessage(ua,this.$FBRTCCallController5.peerID,this.$FBRTCCallController5.callID,ta,this.$FBRTCCallController5.localStream.hasVideo());this.$FBRTCCallControllerz=setTimeout(function(){this.$FBRTCCallController9(u.CallEndReason.NO_ANSWER_TIMEOUT,false,true,false);}.bind(this),qa);};sa.prototype.$FBRTCCallControllerL=function(){"use strict";var ta;if(this.$FBRTCCallController5.receivedNack){ta=u.CallEndReason.UNSUPPORTED_VERSION;ia.showDialog(ia.dialogTypes.PEER_BROWSER_UNSUPPORTED,this.$FBRTCCallController5);}else ta=u.CallEndReason.OTHER_NOT_CAPABLE;this.$FBRTCCallController9(ta,false,true,false,'TimedOut');};sa.prototype.$FBRTCCallControllerJ=function(){"use strict";if(!this.$FBRTCCallController5.isRemoteVideoSupported)return;this.$FBRTCCallControllerl.sendMuteStateUpdate(this.$FBRTCCallController5.peerID,this.$FBRTCCallController5.callID,this.$FBRTCCallController5.localStream.hasVideo());};sa.prototype.$FBRTCCallControllerH=function(ta){"use strict";this.$FBRTCCallController5.remoteStream.setVideoEnabled(ta);};sa.prototype.$FBRTCCallControllerc=function(ta){"use strict";this.$FBRTCCallControllerp=new ja(this.$FBRTCCallControllerl);this.$FBRTCCallControllerp.addListener('sendingRetry',this.$FBRTCCallControllerK.bind(this));this.$FBRTCCallControllerp.sendMessage(u.PayloadType.ANSWER,this.$FBRTCCallController5.peerID,this.$FBRTCCallController5.callID,ta,this.$FBRTCCallController5.localStream.hasVideo());};sa.prototype.$FBRTCCallControllerK=function(){"use strict";var ta=this;this.$FBRTCCallControllerr.drainCandidates(this.$FBRTCCallController5.peerID,this.$FBRTCCallController5.callID,function(ua){ta.$FBRTCCallControllerM(ua);});};sa.prototype.$FBRTCCallControllerM=function(ta){"use strict";this.$FBRTCCallControllerl.sendIceCandidate(this.$FBRTCCallController5.peerID,this.$FBRTCCallController5.callID,ta);};sa.prototype.$FBRTCCallControllerI=function(ta,ua){"use strict";this.$FBRTCCallController5.isRemoteVideoSupported=ea.isVideoSupported(ta);if(ua){this.$FBRTCCallControllera.onReceivedOfferSDP(ta);}else this.$FBRTCCallControllera.onReceivedAnswerSDP(ta);};sa.prototype.$FBRTCCallControllerd=function(ta){"use strict";this.$FBRTCCallControllerr.cacheCandidate(this.$FBRTCCallController5.peerID,this.$FBRTCCallController5.callID,ta);this.$FBRTCCallControllerM(ta);};sa.prototype.$FBRTCCallControllere=function(){"use strict";this.$FBRTCCallControllert=true;var ta=this;this.$FBRTCCallControllers.drainCandidates(this.$FBRTCCallController5.peerID,this.$FBRTCCallController5.callID,function(ua){ta.$FBRTCCallControllera.onReceivedRemoteIceCandidate(ua);});};sa.prototype.$FBRTCCallControllerf=function(){"use strict";this.$FBRTCCallControllerN();this.$FBRTCCallController7.onCallConnected();this.$FBRTCCallControllery.onCallHeartbeat(this.$FBRTCCallController7);this.$FBRTCCallController0.logInfo(this.$FBRTCCallController5.peerID,this.$FBRTCCallController5.callID,'Call Connected');};sa.prototype.$FBRTCCallControllerg=function(){"use strict";this.$FBRTCCallController9(u.CallEndReason.CONNECTION_DROPPED,false,true,false);};sa.prototype.$FBRTCCallControlleri=function(ta){"use strict";this.$FBRTCCallController9(u.CallEndReason.WEBRTC_ERROR,false,true,false,ta.endCallSubreason);this.$FBRTCCallController0.logError(this.$FBRTCCallController5.peerID,this.$FBRTCCallController5.callID,'webrtc error: '+JSON.stringify(ta.details));};sa.prototype.$FBRTCCallControllern=function(ta,ua){"use strict";this.$FBRTCCallController9(ta,false,false,false,ua);};sa.prototype.$FBRTCCallControllerm=function(ta,ua){"use strict";var va=ua.call_id,wa=ua.type;if(this.$FBRTCCallController5.isEnded()){this.$FBRTCCallController0.logError(this.$FBRTCCallController5.peerID,this.$FBRTCCallController5.callID,'Message sent after call ended: '+wa);return;}if(this.$FBRTCCallController5.peerID!==ta||this.$FBRTCCallController5.callID!==va)return;this.$FBRTCCallController8.onMessageTypeSent(wa);this.$FBRTCCallController7.onMessageTypeSent(ua);};sa.prototype.$FBRTCCallControllerx=function(ta){"use strict";if(!ta.payload||!ta.call_id||!ta.from){this.$FBRTCCallController0.logError(this.$FBRTCCallController5.peerID,this.$FBRTCCallController5.callID,'Unknown data: '+JSON.stringify(ta));return;}var ua=ta.from,va=parseInt(ta.call_id,10),wa=JSON.parse(ta.payload),xa=wa.type,ya=ta.source;if(aa.shouldIgnoreInteropMessage(ya)){this.$FBRTCCallController0.logInfo(this.$FBRTCCallController5.peerID,this.$FBRTCCallController5.callID,'Ignoring message (no-interop): '+wa.msg_id);return;}this.$FBRTCCallController0.logReceivedMessage(ua,va,wa);if(this.$FBRTCCallController5.isEnded()){this.$FBRTCCallController0.logInfo(this.$FBRTCCallController5.peerID,this.$FBRTCCallController5.callID,'Ignoring message (call ended): '+wa.msg_id);return;}if(!z.check(ua,va,wa.msg_id)){this.$FBRTCCallController0.logInfo(this.$FBRTCCallController5.peerID,this.$FBRTCCallController5.callID,'Ignoring message (duplicate): '+wa.msg_id);return;}if(this.$FBRTCCallController5.peerID&&this.$FBRTCCallController5.peerID!==ua){if(xa===u.PayloadType.OFFER)this.$FBRTCCallControllerO(ua,va,wa);this.$FBRTCCallController0.logInfo(this.$FBRTCCallController5.peerID,this.$FBRTCCallController5.callID,'Ignoring message (different peer): '+wa.msg_id);return;}if(this.$FBRTCCallController5.callID&&this.$FBRTCCallController5.callID!==va&&xa!==u.PayloadType.OFFER&&xa!==u.PayloadType.ICERESTART_OFFER&&xa!==u.PayloadType.ICE_CANDIDATE){this.$FBRTCCallController0.logInfo(this.$FBRTCCallController5.peerID,this.$FBRTCCallController5.callID,'Ignoring message (different call): '+wa.msg_id);return;}this.$FBRTCCallController8.onMessageTypeReceived(xa);if(this.$FBRTCCallController5.callID&&this.$FBRTCCallController5.callID===va)this.$FBRTCCallController7.onMessageTypeReceived(wa);switch(xa){case u.PayloadType.OFFER:wa=aa.maybeDisableVideoInOffer(wa,ya);this.$FBRTCCallControllerP(wa);break;case u.PayloadType.ANSWER:this.$FBRTCCallControllerQ(wa);this.$FBRTCCallControllery.onCallHeartbeat(this.$FBRTCCallController7);break;case u.PayloadType.ICE_CANDIDATE:this.$FBRTCCallControllerR(wa);break;case u.PayloadType.HANGUP:this.$FBRTCCallControllerS(wa);break;case u.PayloadType.ICERESTART_OFFER:this.$FBRTCCallControllerP(wa);break;case u.PayloadType.OFFER_ACK:this.$FBRTCCallControllerT();this.$FBRTCCallControllery.onCallHeartbeat(this.$FBRTCCallController7);break;case u.PayloadType.OFFER_NACK:this.$FBRTCCallController5.receivedNack=true;break;case u.PayloadType.ANSWER_ACK:this.$FBRTCCallControllerN();break;case u.PayloadType.SET_VIDEO:if(this.$FBRTCCallController5.isRemoteVideoSupported)this.$FBRTCCallControllerH(wa.videoon);break;case u.PayloadType.OK:case u.PayloadType.OTHER_DISMISS:case u.PayloadType.MSG_ACK:case u.PayloadType.PRANSWER:case u.PayloadType.ICERESTART_ANSWER:break;default:break;}};sa.prototype.$FBRTCCallControllerO=function(ta,ua,va){"use strict";var wa=new r({peerID:ta,callID:ua,isCaller:false});wa.onMessageTypeReceived(va);this.$FBRTCCallControllerl.sendOfferAck(ta,ua,va);wa.onOfferAckSent(va);var xa=u.CallEndReason.IN_ANOTHER_CALL;this.$FBRTCCallControllerU(ta,ua,xa);wa.onCallEnded(xa,false);wa.save(this.$FBRTCCallController2);};sa.prototype.$FBRTCCallControllerP=function(ta){"use strict";this.$FBRTCCallControllerl.sendOfferAck(this.$FBRTCCallController5.peerID,ta.call_id,ta);this.$FBRTCCallControllerl.sendOtherDismiss(ta.call_id);if(this.$FBRTCCallControllerV(ta)){this.$FBRTCCallControllerW(ta);}else this.$FBRTCCallControllerX();};sa.prototype.$FBRTCCallControllerV=function(ta){"use strict";if(ta.call_id===this.$FBRTCCallController5.callID)return true;return ((this.$FBRTCCallControllerz||!this.$FBRTCCallController3)&&(!this.$FBRTCCallController5.callID||ta.call_id!==this.$FBRTCCallController5.callID)&&this.$FBRTCCallController5.isCaller&&(!ta.handlescollision||ta.call_id<this.$FBRTCCallController5.callID));};sa.prototype.$FBRTCCallControllerW=function(ta){"use strict";if(ta.hasOwnProperty('videoon'))this.$FBRTCCallControllerH(ta.videoon);this.$FBRTCCallControllerT();this.$FBRTCCallControllerY();this.$FBRTCCallControllerN();if(this.$FBRTCCallController5.callID!==ta.call_id){var ua=u.CallEndReason.OTHER_INSTANCE_HANDLED;this.$FBRTCCallControllerU(this.$FBRTCCallController5.peerID,this.$FBRTCCallController5.callID,ua);this.$FBRTCCallController7.onCallEnded(ua,false);this.$FBRTCCallController7.save(this.$FBRTCCallController2);this.$FBRTCCallController7=new r({peerID:this.$FBRTCCallController5.peerID,callID:ta.call_id,isCaller:false});this.$FBRTCCallController7.onMessageTypeReceived(ta);this.$FBRTCCallController7.onOfferAckSent(ta);this.$FBRTCCallController0.logEvent(this.$FBRTCCallController5.peerID,this.$FBRTCCallController5.callID,'Handling offer collision');}else this.$FBRTCCallController0.logEvent(this.$FBRTCCallController5.peerID,this.$FBRTCCallController5.callID,'Handling offer refresh');this.$FBRTCCallControllera.end();this.$FBRTCCallControllert=false;this.$FBRTCCallController8.reset(ta.call_id,this.$FBRTCCallController7);la.setCallModel(this.$FBRTCCallController5);if(this.$FBRTCCallController5.canStartCall()){this.$FBRTCCallControllerI(ta.sdp,true);la.onCallStarted();this.$FBRTCCallControllerJ();}else this.$FBRTCCallController3=ta;};sa.prototype.$FBRTCCallControllerX=function(){"use strict";this.$FBRTCCallController0.logEvent(this.$FBRTCCallController5.peerID,this.$FBRTCCallController5.callID,'Ignoring offer');};sa.prototype.$FBRTCCallControllerQ=function(ta){"use strict";this.$FBRTCCallControllerT();this.$FBRTCCallControllerY();this.$FBRTCCallControllerl.sendAnswerAck(this.$FBRTCCallController5.peerID,this.$FBRTCCallController5.callID,ta);this.$FBRTCCallControllerI(ta.sdp,false);if(ta.hasOwnProperty('videoon'))this.$FBRTCCallControllerH(ta.videoon);this.$FBRTCCallControllerJ();};sa.prototype.$FBRTCCallControllerR=function(ta){"use strict";if(ta.call_id===this.$FBRTCCallController5.callID&&this.$FBRTCCallControllert){this.$FBRTCCallControllera.onReceivedRemoteIceCandidate(ta);}else this.$FBRTCCallControllers.cacheCandidate(this.$FBRTCCallController5.peerID,ta.call_id,ta);};sa.prototype.$FBRTCCallControllerS=function(ta){"use strict";if(ta.call_id===this.$FBRTCCallController5.callID){this.$FBRTCCallController9(ta.reason,true,false);}else this.$FBRTCCallController0.logError(this.$FBRTCCallControllerZ.peerID,this.$FBRTCCallControllerZ.callID,'Reciving hangup for a different call: '+ta.call_id.toString());};sa.prototype.$FBRTCCallController9=function(ta,ua,va,wa,xa){"use strict";if(typeof ta=='string'||ta instanceof String)ta=u.endCallReasonFromString(ta);var ya=u.fullCallEndReasonString(ta,ua);this.$FBRTCCallController0.logCallAction(this.$FBRTCCallController5.peerID,this.$FBRTCCallController5.callID,y.CallAction.END_CALL,ya);this.$FBRTCCallControllerT();this.$FBRTCCallControllerY();this.$FBRTCCallControllerN();if(this.$FBRTCCallController5.isEnded()){this.$FBRTCCallController0.logError(this.$FBRTCCallController5.peerID,this.$FBRTCCallController5.callID,'Ending an already-ended call');return;}if(va)this.$FBRTCCallControllerU(this.$FBRTCCallController5.peerID,this.$FBRTCCallController5.callID,ta,wa);this.$FBRTCCallControllera.end();fa.end();this.$FBRTCCallController8.end(ta,ua);this.$FBRTCCallController7.onCallEnded(ta,ua,null,xa);la.onCallEnded();this.$FBRTCCallController7.save(this.$FBRTCCallController2);if(this.$FBRTCCallController5.isCaller&&this.$FBRTCCallController10())this.$FBRTCCallController11(this.$FBRTCCallController5.peerID,this.$FBRTCCallController5.callID);};sa.prototype.$FBRTCCallControllerU=function(ta,ua,va,wa){"use strict";this.$FBRTCCallControllerl.sendHangup(ta,ua,va,wa);this.$FBRTCCallControllerl.sendOtherDismiss(ua);};sa.prototype.$FBRTCCallControllerT=function(){"use strict";if(this.$FBRTCCallControllero)this.$FBRTCCallControllero.stopRetrying();};sa.prototype.$FBRTCCallControllerN=function(){"use strict";if(this.$FBRTCCallControllerp)this.$FBRTCCallControllerp.stopRetrying();};sa.prototype.$FBRTCCallControllerY=function(){"use strict";if(this.$FBRTCCallControllerz)clearTimeout(this.$FBRTCCallControllerz);this.$FBRTCCallControllerz=null;};sa.prototype.$FBRTCCallController11=function(ta,ua){"use strict";var va={call_id:ua,message_type:i.VideoChatConstants.CANCELLED_CALL,id_target:ta,clicked_cancelled:true},wa=new g().setErrorHandler(na).setData(va).setURI('/ajax/chat/video/video.php').setAllowCrossPageTransition(true);wa.send();};sa.prototype.$FBRTCCallController10=function(){"use strict";return this.$FBRTCCallController5.wasConnected===false;};e.exports=sa;},null);